<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 随机数及其计算机算法 | Wayne的博客</title><meta name="description" content="随机数及其计算机算法 - Micheal Wayne"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/scss/casual.css"><link rel="stylesheet" href="/css/icon.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.michealwayne.cn/atom.xml" title="Wayne的博客"></head><script>(function (w) {w.frontjsConfig={token:"81a82620fb0dca7680f2f06be134fa4f",behaviour:8,FPSThreshold:10};w.frontjsTmpData = {r:[],e:[],l:[]};w.frontjsTmpCollector = function (ev) {(ev.message ? window.frontjsTmpData.e : window.frontjsTmpData.r).push([new Date().getTime(), ev])};w.FrontJS = {addEventListener: function (t, f) {w.frontjsTmpData.l.push([t, f]);return f;},removeEventListener: function (t, f) {for (var i = 0; i < w.frontjsTmpData.l.length; i++) {t === w.frontjsTmpData.l[i][0] && f === w.frontjsTmpData.l[i][1] && w.frontjsTmpData.l.splice(i, 1);}return f;}};w.document.addEventListener("error", w.frontjsTmpCollector, true);w.addEventListener("error", w.frontjsTmpCollector, true);w.addEventListener("load", function () {var n = w.document.createElement("script");n.src = "https://frontjs-static.pgyer.com/dist/current/frontjs.web.min.js"; w.document.body.appendChild(n);}, true);})(window);</script><body><div class="header"><header class="site-header"><div class="site-nav"><span class="button-toggle"></span><div class="container"><div class="nav-item"><a href="/" target="_self" data-text="home">主页</a></div><div class="nav-item"><a href="/archives" target="_self" data-text="archive">归档</a></div><div class="nav-item"><a href="/about" target="_self" data-text="about">关于</a></div></div><form id="search-form" class="nav-item"><input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" autocomplete="off" autocorrect="off" class="search form-control"><span onclick="resetSearch()" class="fa fa-times"> </span></form><div id="local-search-result"></div><p class="no-result">No results found</p></div></header></div><div class="main"><div class="container"><div class="content"><div class="post"><article class="post-block"><h1 class="post-title">随机数及其计算机算法</h1><span class="post-date">Apr 11, 2021</span><span class="post-tag"><a href="/tags/编码/">编码</a><a href="/tags/算法/">算法</a><a href="/tags/安全/">安全</a></span><img src="/images/random/i-logo.jpg" class="bgimage"><div class="post-content"><h1 id="随机数及其计算机算法"><a href="#随机数及其计算机算法" class="headerlink" title="随机数及其计算机算法"></a>随机数及其计算机算法</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>无论用哪种编程语言开发，都有可能会遇到随机数的需求。当然在开发过程中我们会之间调用API方法来实现，比如js的<code>Math.random()</code>、Python的<code>random()</code>，但其实现原理也是一个值得深究的问题。</p>
<h3 id="随机数的应用"><a href="#随机数的应用" class="headerlink" title="随机数的应用"></a>随机数的应用</h3><ul>
<li><strong>仿真</strong>：当使用一台计算机仿真自然现象时，就需要用随机数使事情变得更真，比如模拟机场人流。</li>
<li><strong>抽样</strong>：通常，要考察所有可能的情况是不实际的，而随机的抽样将使我们能了解“典型”的行为。</li>
<li><strong>数值分析</strong>：利用随机数已经想出了许多巧妙的技术来解复杂的数值问题。</li>
<li><strong>计算机程序设计</strong>：为验证计算机算法的有效性，随机值乃是数据的好来源。更重要的是，随机值对于随机化算法的运算是很要紧的，随机化算法经常比确定性算法要优越得多。</li>
<li><strong>决策</strong>：许多决策人通过抛硬币或掷飞镖等来做出判断，做出这样完全“无偏见”的判断是重要的，随机性也是矩阵游戏理论中优化策略的必不可少的部分</li>
<li>美学：一点儿随机性就会使计算机生成的图形和音乐似乎更活泼。</li>
<li><strong>娱乐</strong>：摇骰子、洗扑克牌、转轮盘等娱乐方式，随意数的这些传统用法，已经被命名为“蒙特卡洛方法”，它已成为描述任何使用随机数的算法的通用术语。</li>
</ul>
<h2 id="随机数概念"><a href="#随机数概念" class="headerlink" title="随机数概念"></a>随机数概念</h2><h3 id="概率论"><a href="#概率论" class="headerlink" title="概率论"></a>概率论</h3><p>首先来回顾下大学里概率论中与随机数相关的概念：</p>
<ul>
<li><strong>频率</strong>：定义在相同的条件下，进行了n次实验，在这n次实验中，事件A发生的次数nA称为事件A发生的频数，比值nA/n称为事件A发生的频率。</li>
<li><strong>概率</strong>：设E是随机试验，S是它的样本空间，对于E的每一事件A赋予一个实数，记为P(A)，称为事件的概率。</li>
<li><strong>随机变量</strong>：设随机试验的样本空间为S={e}，若X=X(e)为定义在样本空间S上的实值单值函数，则称X=X(e)为随机变量。</li>
<li><strong>随机事件</strong>：在条件S下可能发生也可能不发生的事件，叫相对于条件S的随机事件。</li>
</ul>
<p>一个确定分布的独立的随机数序列：每个数的出现都只是偶然的，并且与这序列中的其他数无关，每个数入任何给定的范围都有一个确定的概率。</p>
<p>随机事件在一次试验中发生与否是随机的，但随机性中含有规律性。随机事件A的概率是频率的稳定值，频率是概率的近似值。</p>
<p>像js中的<code>Math.random()</code>在概率分布理论中属于连续和离散的均匀分布。<strong>均匀分布的特点</strong>是：所有基本事件的可能性相等。</p>
<h3 id="判定标准"><a href="#判定标准" class="headerlink" title="判定标准"></a>判定标准</h3><p>可以参考<a href="https://zh.wikipedia.org/w/index.php?title=Federal_Office_for_Information_Security&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener">Federal Office for Information Security （德国联邦信息安全办公室）</a>给出了随机数发生器质量评判的四个标准-BSI评估标准：</p>
<ul>
<li>K1 - 产生的随机数序列彼此不同的概率应该是很高的</li>
<li>K2 - 根据某些统计测试，无法分辨产生的序列和真随机序列。这些测试包括： monobit测试（序列中的0和1的数量相等）、poker测试（ chi-squared测试的特殊情况）、runs测试（不同长度运行的频率）、来自于BSI[15] 和NIST,[16]的longruns测试、autocorrelation测试。</li>
<li>K3 - 给定任何子序列，任何攻击者都无法计算后续序列或者生成器的内部状态</li>
<li>K4 - 给定生成器的内部状态，任何攻击者都无法计算之前的序列或者生成器之前的状态<br>对于密码学应用，只有满足K3和K4标准的生成器是可以接受的。</li>
</ul>
<h2 id="计算机实现"><a href="#计算机实现" class="headerlink" title="计算机实现"></a>计算机实现</h2><p>确定性的方法无法真实地创造随机性，正如《计算机程序设计艺术（第二卷）》书中所说：“当今使用的大部分随机数生成器都不够优秀，而且开发者倾向于拿来就用，不去了解具体的生成策略。以至于我们常常发现一些略有瑕疵、年代久远的随机数生成器会被盲目地用在一个又一个的程序中，而对于它们的局限性，却无人问津。”</p>
<h3 id="发展"><a href="#发展" class="headerlink" title="发展"></a>发展</h3><ul>
<li><p>早期，那些在科学工作中需要随机数的人们，用一个“充分转动起来”的坛子中抓出球来或要骰子、分牌之类的办法获得随机数。</p>
</li>
<li><p>1927年，L.H.C.Tippett发布超过40000个随机数字的一张表，那些数字是“从人口统计调查报告中随机地取得的”。自那以后，已经造出了一些特殊的装置，用来机械地生成随机数。</p>
</li>
<li><p>1939年，M.G.Kendall和B.Babington-Smith使用头一部这样的机器造出了有100000个随机数字的一张表</p>
</li>
<li><p>1949年，D.H.Lehmer提出线性同余法（LCG）的算法方案。</p>
</li>
<li><p>1951年首次安装的Ferranti Mark  Ⅰ计算机有一个内置指令，它使用一个电阻噪声生成器将20个随机位放入累加器中，这一功能受到了A.M.Turing的推荐。</p>
</li>
<li><p>1955年，RAND公司又公布了一张被广泛使用的有100万个随机数字的表，这张表是利用另一部特殊装置得到的。一台取名为ERNIE（厄尼）的著名随机数机器被使用了许多年，用于产生英国政府有奖债券的中奖号码。</p>
</li>
<li><p>在计算机问世之后不久，人们开始探求在计算机程序中求随机数的有效方法，可以使用一张表，但由于内存空间和输入时间的要求，这种方法的实用性有限。在20世纪90年代技术的发展又使这张表变得有用起来，因为CDROM上可以分布（存储）1GB的经过测试的随机数。</p>
</li>
<li><p>1995年，George Marsaglia 将一个噪声二极管的电流输出与确定的经过扰频的rap音乐叠加在一起生成了650MB的随机值（称之为黑白噪声）并把它们做成演示光盘，因而促进了随机数表的复兴。</p>
</li>
<li><p>2014年，计算机PRNG算法-PCG诞生，它以更小的，快速的代码和小的状态量实现了出色的统计性能。</p>
</li>
</ul>
<h3 id="算法（伪随机）"><a href="#算法（伪随机）" class="headerlink" title="算法（伪随机）"></a>算法（伪随机）</h3><h4 id="平方取中法-随机序列"><a href="#平方取中法-随机序列" class="headerlink" title="平方取中法-随机序列"></a>平方取中法-随机序列</h4><p>早期用机械方式生成随机数的缺点，引起了人们利用一台计算机的普通算术操作来产生随机数的兴趣。1946年前后，Jogn von Neumann（冯诺伊曼）头一个建议利用这种方法。他的办法是取前面的随机数的平方，并抽取中部的数字。</p>
<p>例如，如果正在生成10位数字，并且先前的值是5772156649，则把它平方得到33317792380594909201，因此下一个数就是7923805949。</p>
<p>对于这种技术，有十分明显的异议：既然每个数完全由它先前的数所决定，那么以这样的方法产生的序列怎么会是随机的呢？这个序列当然不是随机的，仅仅像是随机的而已。在典型的应用中，一个数与跟在它后面的那个数之间的真实关系并无客观的意义，因此，这种非随机性的特征并不真是不可取的。从直观上看，平方取中似乎相当充分地搅乱了前面的数。</p>
<p>已经证明，冯诺伊曼的这种方法并不是求随机数的好方法，危险在于这个序列容易出现重复元素的短循环。例如，如果0一旦作为这个序列的一个数出现，则它将不断地重现本身。</p>
<p>一些人在20世纪50年代初曾以“平方取中法”进行了实验。G.E.Forsythe用4位数字代替10位数字，试验了16个不同的初始值，结果发现，其中的12个导致了以循环6100、2100、4100、8100、6100,…为结局的序列，而其中有两个退化成0。N.Metropolis对平方取中法进行了广泛的试验，试验中大多采用二进数系统，他证明了：用20位数字进行工作时，序列可能退化成13个不同的循环，其中最长的循环周期位142。</p>
<h4 id="π（Pi）—随机序列"><a href="#π（Pi）—随机序列" class="headerlink" title="π（Pi）—随机序列"></a>π（Pi）—随机序列</h4><p>1965年，根据I.J.Matrix博士的说法，数学家把π的十进制展开当做是随机序列，而对于一个现代数值逻辑学家说来，它有极丰富的值得注意的模式。</p>
<p>例如，Matrix博士指出，在π的展开式中头一次重复的两位数字是26，而它的第二次出现是在一个奇妙的重复模式中间</p>
<p><img src="/images/random/p-5.png" alt="p-5.png"></p>
<p>在列出许多位数字或它们的其他性质之后，人们就会发现，如果正确地解释的话，π可以反映人类经历的整个历史。</p>
<h4 id="算法K-超随机数生成程序"><a href="#算法K-超随机数生成程序" class="headerlink" title="算法K-超随机数生成程序"></a>算法K-超随机数生成程序</h4><p><img src="/images/random/p-2.png" alt="p-2.png"></p>
<p><img src="/images/random/p-3.png" alt="p-3.png"></p>
<p>（其中X是一个10位的十进制数）</p>
<p>考虑到算法K的复杂设计，这一算法似乎能产生无穷尽的令人难以置信的随机数，但事实上，当把这个算法头一次放到计算机上时，它几乎立即收敛到10位数值6065038420——非常巧合，本算法把这个数转换成它自己。若以另外一个数开始，则这个序列在7401个值之后，开始以长度为3178的周期进行循环</p>
<p><img src="/images/random/p-4.png" alt="p-4.png"></p>
<p>这个事告诉我们，<strong>随机数并不是通过随机地选择的方法就可生成的，应当使用某些理论。</strong></p>
<h4 id="PRNG"><a href="#PRNG" class="headerlink" title="PRNG"></a><a href="https://zh.wikipedia.org/wiki/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E5%99%A8" target="_blank" rel="noopener">PRNG</a></h4><p>后文算法便是通过理论算法实现的，统称为PRNG（pseudo random number generator）伪随机数生成器，又被称为确定性随机比特生成器（deterministic random bit generator，DRBG）。其中适合于加密应用程序的PRNG称为加密安全的PRNG（CSPRNG）。CSPRNG的一个必要条件是不知道初始种子的敌人在分辨生成器的输出序列和真随机序列时只有可忽略的优势。换句话说，若PRNG只需要通过特定统计测试时，则CSPRNG必须通过种子规模的多项式复杂度内的所有统计测试</p>
<p>PRNG是一个生成数字序列的算法，其特性近似于随机数序列的特性。PRNG生成的序列并不是真随机，因此它完全由一个初始值决定，这个初始值被称为PRNG的随机种子（seed，但这个种子可能包含真随机数）。尽管接近于真随机的序列可以通过硬件随机数生成器生成，但伪随机数生成器因为其生成速度和可再现的优势，在实践中也很重要。</p>
<p>PRNG的周期定义为：所有初始值的最大长度的无重复前缀序列。周期受状态数的限制，通常用比特位数表示。然而，每增加一个比特位，周期长度就可能增加一倍，所以构建周期足够长的PRNG对于许多实际应用程序来说是很容易的。</p>
<h4 id="线性同余法LCG（linear-congruential-generators）"><a href="#线性同余法LCG（linear-congruential-generators）" class="headerlink" title="线性同余法LCG（linear congruential generators）"></a>线性同余法<a href="https://en.wikipedia.org/wiki/Linear_congruential_generator" target="_blank" rel="noopener">LCG</a>（linear congruential generators）</h4><p>当今使用的流行的随机数生成程序是D.H.Lehmer 1949年介绍过的下列方案的特殊情况。我们选择4个魔术整数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m, 模*数； 0&lt;m</span><br><span class="line">a, 乘数；  0&lt;=a&lt;m</span><br><span class="line">c, 增量；  0&lt;=c&lt;m</span><br><span class="line">X0,开始值; 0&lt;=X0&lt;m</span><br></pre></td></tr></table></figure>
<p>然后通过置公式（1）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xn+1 = (aX0 + c) mod m,  n&gt;=0</span><br></pre></td></tr></table></figure>
<p>而得到所求的随机数序列<code>&lt;Xn&gt;</code>。这个序列称做线性同余序列。对m求余有点像确定转动的轮盘上球的落点。</p>
<p>例如，当m = 10和X0 = a = c = 7时，得到的序列是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7,6,9,0,7,6,9,0...</span><br></pre></td></tr></table></figure>
<p>如此例所示，对于m, a, c和X0的所有选择，这个序列并不总是“随机”的。这个例子有一个长度为4的周期，也说明了同余序列总是进入一个循环的事实。</p>
<p>改进：</p>
<p>定义<code>b = a - 1</code>，<code>a&gt;=2, b&gt;=1</code>，公式（2）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xn+k = (a^k * Xn + (a^k - 1) * c / b) mod m,  k&gt;=0, n&gt;=0</span><br></pre></td></tr></table></figure>
<p>它借助于第n项来直接表达第(n + k)项，由此得出，由<code>&lt;Xn&gt;</code>的每第k项组成的子序列是另一个线性同余序列，该子序列具有乘数a^k mod m和增量((a^k - 1) * c / b) mod m。</p>
<p>这个公式的一个重要推论是：由m、a、c和X0定义的一般序列，能非常简单地借助c=1和X0=0的特殊情况来表示，设</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y0 = 0, Yn+1 = (a * Yn + 1) mod m</span><br></pre></td></tr></table></figure>
<p>根据公式（2），我们得到Yk等于(a^k - 1) / b(modulo m)，因此公式（1）中定义的一般序列满足</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xn = (A * Yn + X0) mod m，其中A = (X0 * b + c) mod m</span><br></pre></td></tr></table></figure>
<p>并且可以通过分析（详见《计算机程序设计艺术（第二卷）》3.2.1.1）得出m可以取<code>2^31 - 1</code>（<code>2^32</code>）；乘数a选择在<code>0.01m</code>和<code>0.99m</code>之间，而且它的二进制表示或十进制表示数字不应有一个简单的正规模式，推荐值是（<code>7^5</code>，即<code>16807</code>）； c 与 m 互质。</p>
<p>但是对于现代的计算机而言，这样的周期还是太短了。生成器的内部结构如栅栏结构和超平面点的分布也很重要。对于不同的生成器有特定的检测方法。结构检测用到最多的就是谱检验，谱检验就是基于相邻平行超平面之间最大距离的检验，该距离越大，生成器越差。</p>
<p>如图：</p>
<p><img src="/images/random/p-7.jpg" alt="p-7.jpg"></p>
<h4 id="MWC-梅森旋转算法"><a href="#MWC-梅森旋转算法" class="headerlink" title="MWC-梅森旋转算法"></a><a href="https://en.wikipedia.org/wiki/Multiply-with-carry" target="_blank" rel="noopener">MWC</a>-梅森旋转算法</h4><p>1991年，MWC（<a href="https://en.wikipedia.org/wiki/Multiply-with-carry" target="_blank" rel="noopener">multiply-with-carry</a>）由 <a href="http://digitalcommons.wayne.edu/cgi/viewcontent.cgi?article=1725&amp;context=jmasm" target="_blank" rel="noopener">George Marsaglia</a> 和 Zaman 发明，非常类似于 LCG。MWC以其最简单的形式使用与线性同余生成器类似的公式，但是c（“加数”）在每次迭代中都不同。</p>
<p>其优势在于调用简单的计算机整数算法，使得非常快速地生成具有巨大周期的随机数序列；生成的循环周期更长（<code>2^60</code> ~ <code>2^2000000</code>），接近于 CPU 的循环周期。</p>
<p>它被广泛运用于游戏类的开发中，被非正式地称为“所有PRNG的母亲”，这个名字最初由Marsaglia自己创造。</p>
<p>以下是使用128位乘法并具有64位输出的小型MWC生成器的c语言实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C99 + __uint128_t MWC, 256 bits of state, period approx. 2^255</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The state must be neither all zero, nor x = y = z = 2^64 - 1, c =</span></span><br><span class="line"><span class="comment">   MWC_A3 - 1. The condition 0 &lt; c &lt; MWC_A3 - 1 is thus sufficient. */</span></span><br><span class="line">   </span><br><span class="line"><span class="keyword">uint64_t</span> x, y, z, c = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MWC_A3 0xff377e26f82da74a</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="keyword">inline</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">__uint128_t</span> t = MWC_A3 * (<span class="keyword">__uint128_t</span>)x + c;</span><br><span class="line">    x = y;</span><br><span class="line">    y = z;</span><br><span class="line">    c = t &gt;&gt; <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">return</span> z = t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="MWC1616"><a href="#MWC1616" class="headerlink" title="MWC1616"></a>MWC1616</h5><p>一个高速、简便的MWC实现，其中js的V8引擎早期就是用了它（见后文）。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ulong unsigned long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> ulong mwc1616_x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> ulong mwc1616_y = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">seed_rand_mwc1616</span><span class="params">(ulong seed)</span> </span>&#123;</span><br><span class="line">    mwc1616_x = seed | <span class="number">1</span>;   <span class="comment">/* Can't seed with 0 */</span></span><br><span class="line">    mwc1616_y = seed | <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ulong <span class="title">rand_mwc1616</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    mwc1616_x = <span class="number">18000</span> * (mwc1616_x &amp; <span class="number">0xffff</span>) + (mwc1616_x &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    mwc1616_y = <span class="number">30903</span> * (mwc1616_y &amp; <span class="number">0xffff</span>) + (mwc1616_y &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (mwc1616_x&lt;&lt;<span class="number">16</span>)+(mwc1616_y&amp;<span class="number">0xffff</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是MWC无法通过TestU01的多项测试。</p>
<h4 id="PCG"><a href="#PCG" class="headerlink" title="PCG"></a><a href="https://en.wikipedia.org/wiki/Permuted_congruential_generator" target="_blank" rel="noopener">PCG</a></h4><p>置换同余生成器（PCG, permuted congruential generator）是LCG的改进，2014产生。它以更小的，快速的代码和小的状态量实现了出色的统计性能。<br>PCG与传统线性同余生成器在以下三个方面有所不同：</p>
<ul>
<li>LCG模数和状态较大，通常是所需输出大小的两倍；</li>
<li>它使用2的幂模，这导致使用全周期发生器和无偏输出位特别有效的实现</li>
<li>状态不是直接输出，而是状态的最高有效位用于选择按位旋转或移位，将其应用于状态以产生输出。</li>
</ul>
<p>也正是可变的旋转，消除了2次幂的LCG的低阶比特短时间周期的问题。</p>
<p>PCG系列包括许多变体。虽然实际建议仅使用64位和128位，但核心LCG的定义宽度为8位至128位。如PCG-XSH-RR：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint64_t</span>       state      = <span class="number">0x4d595df4d0f33173</span>;		<span class="comment">// Or something seed-dependent</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint64_t</span> <span class="keyword">const</span> multiplier = <span class="number">6364136223846793005u</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint64_t</span> <span class="keyword">const</span> increment  = <span class="number">1442695040888963407u</span>;	<span class="comment">// Or an arbitrary odd constant</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">uint32_t</span> <span class="title">rotr32</span><span class="params">(<span class="keyword">uint32_t</span> x, <span class="keyword">unsigned</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x &gt;&gt; r | x &lt;&lt; (-r &amp; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">pcg32</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">uint64_t</span> x = state;</span><br><span class="line">	<span class="keyword">unsigned</span> count = (<span class="keyword">unsigned</span>)(x &gt;&gt; <span class="number">59</span>);		<span class="comment">// 59 = 64 - 5</span></span><br><span class="line"></span><br><span class="line">	state = x * multiplier + increment;</span><br><span class="line">	x ^= x &gt;&gt; <span class="number">18</span>;								<span class="comment">// 18 = (64 - 27)/2</span></span><br><span class="line">	<span class="keyword">return</span> rotr32((<span class="keyword">uint32_t</span>)(x &gt;&gt; <span class="number">27</span>), count);	<span class="comment">// 27 = 32 - 5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pcg32_init</span><span class="params">(<span class="keyword">uint64_t</span> seed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	state = seed + increment;</span><br><span class="line">	(<span class="keyword">void</span>)pcg32();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="XorShift算法"><a href="#XorShift算法" class="headerlink" title="XorShift算法"></a>XorShift算法</h4><p>XorShift随机数生成器，也称为移位寄存器生成器，是George Marsaglia发现的一类伪随机数生成器。它是线性反馈移位寄存器（LFSR）的子集，它们允许在软件中进行特别有效的实现，而无需使用过于稀疏的多项式。</p>
<p>它的实现基本原理是通过重复取其自身或移位版本的数字的异或来生成其序列中的下一个数字，这使得它具有高效的特征。</p>
<p>它的缺点也是众所周知的，可以通过将它们与非线性函数结合来加以修正，例如在xorshift+或xorshift*生成器中。</p>
<p>xorshift有三种简单的模式：32-bit、64-bit、128-bit，如下列c的实现：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 32-bit */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorshift32_state</span> &#123;</span></span><br><span class="line">  <span class="keyword">uint32_t</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">xorshift32</span> <span class="params">(struct xorshiift32_state *state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> x = state-&gt;a;</span><br><span class="line">  x ^= x &lt;&lt; <span class="number">13</span>;</span><br><span class="line">  x ^= x &gt;&gt; <span class="number">17</span>;</span><br><span class="line">  x ^= x &lt;&lt; <span class="number">5</span>;</span><br><span class="line">  <span class="keyword">return</span> state-&gt;a=x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 64-bit */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorshift64_state</span> &#123;</span></span><br><span class="line">  <span class="keyword">uint64_t</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">xorshift64</span> <span class="params">(struct xorshift64_state *state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint64_t</span> x = state-&gt;a;</span><br><span class="line">  x ^= x &lt;&lt; <span class="number">13</span>;</span><br><span class="line">  x ^= x &gt;&gt; <span class="number">7</span>;</span><br><span class="line">  x ^= x &lt;&lt; <span class="number">17</span>;</span><br><span class="line">  <span class="keyword">return</span> state-&gt;a=x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 128-bit */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorshift128_state</span> &#123;</span></span><br><span class="line">  <span class="keyword">uint32_t</span> a, b, c, d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">xorshift128</span><span class="params">(struct xorshift128_state *state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> t = state-&gt;d;</span><br><span class="line">  <span class="keyword">uint32_t</span> <span class="keyword">const</span> s = state-&gt;a;</span><br><span class="line">  state-&gt;d = state-&gt;c;</span><br><span class="line">  state-&gt;c = state-&gt;b;</span><br><span class="line">  state-&gt;b = s;</span><br><span class="line">  </span><br><span class="line">  t ^= t &lt;&lt; <span class="number">11</span>;</span><br><span class="line">  t ^= t &gt;&gt; <span class="number">8</span>;</span><br><span class="line">  <span class="keyword">return</span> state-&gt;a = t ^ s ^ (s &gt;&gt; <span class="number">19</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中128位算法通过了顽固测试，但是它没有通过TestU01框架的BigCrush测试套件的MatrixRank和LinearComp测试。所有xorshift生成器(包括下面的优化)都无法通过其中的某些测试，但是很容易通过对这种发生器的输出进行干扰以提升其质量。</p>
<h5 id="xsorrow"><a href="#xsorrow" class="headerlink" title="xsorrow"></a>xsorrow</h5><p>Marsaglia建议通过将输出与简单的加法计数器模<code>2^32</code>（Weyl序列）组合，这会使周期增加<code>2^32</code>倍，达到<code>2^192-2^32</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorwow_state</span> &#123;</span></span><br><span class="line">  <span class="keyword">uint32_t</span> a, b, c, d, e;</span><br><span class="line">  <span class="keyword">uint32_t</span> counter;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">xorwow</span> <span class="params">(struct xorwow_state *state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> t = state-&gt;e;</span><br><span class="line">  <span class="keyword">uint32_t</span> s = state-&gt;a;</span><br><span class="line">  state-&gt;e = state-&gt;d;</span><br><span class="line">  state-&gt;d = state-&gt;c;</span><br><span class="line">  state-&gt;c = state-&gt;b;</span><br><span class="line">  state-&gt;b = s;</span><br><span class="line">  t ^= t &gt;&gt; <span class="number">2</span>;</span><br><span class="line">  t ^= t &lt;&lt; <span class="number">1</span>;</span><br><span class="line">  t ^= s ^ (s &lt;&lt; <span class="number">4</span>);</span><br><span class="line">  state-&gt;a = t;</span><br><span class="line">  state-&gt;counter += <span class="number">362437</span>;</span><br><span class="line">  <span class="keyword">return</span> t + state-&gt;counter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该生成器的典型案例是 <a href="https://developer.nvidia.com/zh-cn/cuda-toolkit" target="_blank" rel="noopener">Nvidia CUDA</a> 工具包。</p>
<h5 id="xorshift"><a href="#xorshift" class="headerlink" title="xorshift*"></a>xorshift*</h5><p>xorshift*采用xorshift生成器，并对其输出应用<strong>可逆乘法</strong>（以字大小为模），作为非线性变换。</p>
<p>以下具有64位状态的64位生成器的最大周期为<code>2^64-1</code>，仅TestU01 BigCrush的MatrixRank测试失败：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorshift64s_state</span> &#123;</span></span><br><span class="line">  <span class="keyword">uint64_t</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">xorshift64s</span> <span class="params">(struct xorshift64s_state *state)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint64_t</span> x = state-&gt;a;</span><br><span class="line">  x ^= x &gt;&gt; <span class="number">12</span>;</span><br><span class="line">  x ^= x &lt;&lt; <span class="number">25</span>;</span><br><span class="line">  x ^= x &gt;&gt; <span class="number">27</span>;</span><br><span class="line">  state-&gt;a = x;</span><br><span class="line">  <span class="keyword">return</span> x * UINT64_C(<span class="number">0x2545F4914F6CDD1D</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Vigna 建议使用下面的xorshift1024 *生成器，该生成器具有1024位状态且最大周期为<code>2^1024-1</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The state must be seeded so that there is at least one non-zero element in array */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorshift1024s_state</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="built_in">array</span>[<span class="number">16</span>];</span><br><span class="line">	<span class="keyword">int</span> index;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">xorshift1024s</span><span class="params">(struct xorshift1024s_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> index = state-&gt;index;</span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="keyword">const</span> s = state-&gt;<span class="built_in">array</span>[index++];</span><br><span class="line">	<span class="keyword">uint64_t</span> t = state-&gt;<span class="built_in">array</span>[index &amp;= <span class="number">15</span>];</span><br><span class="line">	t ^= t &lt;&lt; <span class="number">31</span>;		<span class="comment">// a</span></span><br><span class="line">	t ^= t &gt;&gt; <span class="number">11</span>;		<span class="comment">// b</span></span><br><span class="line">	t ^= s ^ (s &gt;&gt; <span class="number">30</span>);	<span class="comment">// c</span></span><br><span class="line">	state-&gt;<span class="built_in">array</span>[index] = t;</span><br><span class="line">	state-&gt;index = index;</span><br><span class="line">	<span class="keyword">return</span> t * (<span class="keyword">uint64_t</span>)<span class="number">1181783497276652981</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="xorshift-1"><a href="#xorshift-1" class="headerlink" title="xorshift+"></a>xorshift+</h5><p>除了使用乘法，还可以使用<strong>加法</strong>作为更快的非线性变换。这个想法最初是由Saito和Matsumoto（还负责Mersenne Twister）在XSadd生成器中提出的，该生成器基于32位移位将基础xorshift生成器的两个连续输出相加。</p>
<p>但是，其输出的低阶位有一些弱点；当输出字位反转时，它在几次BigCrush测试中失败。为了解决这个问题，Vigna 引入了基于64位移位的xorshift +系列：以下xorshift128 +生成器使用128位状态，最大周期为<code>2^128-1</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xorshift128p_state</span> &#123;</span></span><br><span class="line">  <span class="keyword">uint64_t</span> a, b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The state must be seeded so that it is not all zero */</span></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">xorshift128p</span><span class="params">(struct xorshift128p_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">uint64_t</span> t = state-&gt;a;</span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="keyword">const</span> s = state-&gt;b;</span><br><span class="line">	state-&gt;a = s;</span><br><span class="line">	t ^= t &lt;&lt; <span class="number">23</span>;		<span class="comment">// a</span></span><br><span class="line">	t ^= t &gt;&gt; <span class="number">17</span>;		<span class="comment">// b</span></span><br><span class="line">	t ^= s ^ (s &gt;&gt; <span class="number">26</span>);	<span class="comment">// c</span></span><br><span class="line">	state-&gt;b = t;</span><br><span class="line">	<span class="keyword">return</span> t + s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此生成器是通过 BigCrush 测试最快的生成器之一，添加连续输出的一个缺点是，底层的xorshift128生成器是二维分布的，而关联的xorshift128 +生成器只有一维分布的。</p>
<blockquote>
<p>xorshift+没有通过BigCrush的反向测试。</p>
</blockquote>
<h5 id="xoshiro-和-xoroshiro"><a href="#xoshiro-和-xoroshiro" class="headerlink" title="xoshiro 和 xoroshiro"></a>xoshiro 和 xoroshiro</h5><p>xoshiro和xoroshiro是移位寄存器生成器的其他变体，除了移位之外还使用<strong>旋转</strong>。根据Vigna的说法，与xorshift相比，它们速度更快，并产生更好的质量输出。<br>此类生成器具有32位和64位整数和浮点输出的变体。对于浮点数，取高53位（对于binary64）或高23位（对于binary32），因为高位的质量比浮点生成器中的低位更好。该算法还包括跳转功能，该功能将状态向前设置若干步（通常为2的幂），以允许许多执行线程从不同的初始状态开始。</p>
<p>xoshiro256**是该系列的通用随机64位数字生成器：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  Adapted from the code included on Sebastian Vigna's website */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">rol64</span><span class="params">(<span class="keyword">uint64_t</span> x, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (x &lt;&lt; k) | (x &gt;&gt; (<span class="number">64</span> - k));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xoshiro256ss_state</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint64_t</span> s[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">xoshiro256ss</span><span class="params">(struct xoshiro256ss_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">uint64_t</span> *s = state-&gt;s;</span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="keyword">const</span> result = rol64(s[<span class="number">1</span>] * <span class="number">5</span>, <span class="number">7</span>) * <span class="number">9</span>;</span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="keyword">const</span> t = s[<span class="number">1</span>] &lt;&lt; <span class="number">17</span>;</span><br><span class="line"></span><br><span class="line">	s[<span class="number">2</span>] ^= s[<span class="number">0</span>];</span><br><span class="line">	s[<span class="number">3</span>] ^= s[<span class="number">1</span>];</span><br><span class="line">	s[<span class="number">1</span>] ^= s[<span class="number">2</span>];</span><br><span class="line">	s[<span class="number">0</span>] ^= s[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">	s[<span class="number">2</span>] ^= t;</span><br><span class="line">	s[<span class="number">3</span>] = rol64(s[<span class="number">3</span>], <span class="number">45</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xoshiro256+ 比 xoshiro256** 快约15％，但最低的三位具有较低的线性复杂度；因此，应仅通过提取高53位数值并将其用于浮点结果。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">rol64</span><span class="params">(<span class="keyword">uint64_t</span> x, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (x &lt;&lt; k) | (x &gt;&gt; (<span class="number">64</span> - k));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">xoshiro256p_state</span> &#123;</span></span><br><span class="line">	<span class="keyword">uint64_t</span> s[<span class="number">4</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">xoshiro256p</span><span class="params">(struct xoshiro256p_state *state)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">uint64_t</span> (*s)[<span class="number">4</span>] = &amp;state-&gt;s;</span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="keyword">const</span> result = s[<span class="number">0</span>] + s[<span class="number">3</span>];</span><br><span class="line">	<span class="keyword">uint64_t</span> <span class="keyword">const</span> t = s[<span class="number">1</span>] &lt;&lt; <span class="number">17</span>;</span><br><span class="line"></span><br><span class="line">	s[<span class="number">2</span>] ^= s[<span class="number">0</span>];</span><br><span class="line">	s[<span class="number">3</span>] ^= s[<span class="number">1</span>];</span><br><span class="line">	s[<span class="number">1</span>] ^= s[<span class="number">2</span>];</span><br><span class="line">	s[<span class="number">0</span>] ^= s[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">	s[<span class="number">2</span>] ^= t;</span><br><span class="line">	s[<span class="number">3</span>] = rol64(s[<span class="number">3</span>], <span class="number">45</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>值得注意的是：如果空间有限，则xoroshiro128 <strong>等同于xoshiro256 </strong>，xoroshiro128 +等同于xoshiro256 +。它们具有较小的状态空间，因此对于大规模并行程序没有多大用处。 xoroshiro128 +还表现出对Hamming权重的轻微依赖，在输出5TB数据后会产生故障。<br>对于32位输出，xoshiro128 <strong>和xoshiro128 +完全等同于xoshiro256 </strong>和xoshiro256 +。</p>
<h4 id="算法检验"><a href="#算法检验" class="headerlink" title="算法检验"></a>算法检验</h4><p>原则上，在设计随机算法的时候，我们会希望初始状态使用尽可能少的内存，执行速度更快，循环周期更长，且随机性质量越高。</p>
<p><strong>理论检验主要是检验随机数的周期，内在结构和关联性</strong>。不过光理论检验是不够的，我们还需要经验检验。经验检验性对较简单，且有很多的方法。比如：等分布检验：又称均匀性检验，将[0,1)区间分成k个相等的子区间，落在每个子区间的伪随机数个数应该相等。常用的是x^2检验。序列检验：相继的数偶独立一致分布。计算的是数偶对的出现次数。间隔检验：用来考察在某个范围内序列的出现的间隔长度。扑克检验：考虑5个相继整数组成的n个组，观察其出现模式…….</p>
<p>随机性的质量测试主要可以通过工具<a href="http://simul.iro.umontreal.ca/testu01/tu01.html" target="_blank" rel="noopener"><strong>TestU01</strong></a>，它是一个软件库，以ANSI C语言实现，并提供了用于对统一随机数生成器进行经验统计测试的实用程序的集合。<br>TestU01直接测试的必须是一个能生成<code>[0,1)</code>之间浮点数的函数或一个能生成32位全随机无符号整数的函数。<br>它的整套测试被称作BigCrush，是目前最严格的随机数测试套件，它可以很好地检测一个随机数生成器的可靠程度。</p>
<p>如下图所示，只有7中RNG算法通过了测试，详细测试报告可见：<br><a href="https://www.pcg-random.org/pdf/toms-oneill-pcg-family-v1.02.pdf" target="_blank" rel="noopener">https://www.pcg-random.org/pdf/toms-oneill-pcg-family-v1.02.pdf</a></p>
<p><img src="/images/random/p-8.png" alt="p-8.png"></p>
<p>*优秀的PRNG还有很多，像非常安全且周期极长的Mersenne Twiste（马特赛特旋转演算法），本文暂时先不记录。</p>
<hr>
<h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><h4 id="1-ECMAScript（JavaScript）"><a href="#1-ECMAScript（JavaScript）" class="headerlink" title="1.ECMAScript（JavaScript）"></a>1.ECMAScript（JavaScript）</h4><p>毫无疑问是通过<code>Math.random()</code>，首先我们来看官方文档（<a href="https://262.ecma-international.org/6.0/" target="_blank" rel="noopener">ES6</a>）对这个方法的介绍：</p>
<p><img src="/images/random/p-1.png" alt="p-1.png"></p>
<p>简单翻译来说就是通过在<code>0～1</code>范围内以大致均匀的分布随机或伪随机生成一个<code>0～1</code>范围内的数字。以V8引擎为例，我们来看看<code>Math.random()</code>的具体实现：</p>
<p>直至v4.9.40版本，V8选择的是MWC1616算法，核心内容：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint32_t</span> state0 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">uint32_t</span> state1 = <span class="number">2</span>;</span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">mwc1616</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">  state0 = <span class="number">18030</span> * (state0 &amp; <span class="number">0xFFFF</span>) + (state0 &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  state1 = <span class="number">30903</span> * (state1 &amp; <span class="number">0xFFFF</span>) + (state1 &gt;&gt; <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> state0 &lt;&lt; <span class="number">16</span> + (state1 &amp; <span class="number">0xFFFF</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MWC1616的计算速度很快，且占用很少的内存，但是它的质量低于标准水平：</p>
<ul>
<li><p>1.周期范围限制：这种算法的随机数范围在<code>2^32</code>以内，但是双精度浮点数能代表<code>2^52</code>个<code>0～1</code>的小数；</p>
</li>
<li><p>2.结果控制：结果值的上半部分非常依赖于state0；如果初始状态选择不正确，周期长度可能少于4亿；</p>
</li>
<li><p>3.无法通过TestU01的多项测试。</p>
</li>
</ul>
<p>因此V8对随机数的算法进行了优化（v4.9.41.0开始，Chrome49开始）：</p>
<h5 id="最新（2021-04-11）V8的实现（目录地址：v8-src-numbers-）"><a href="#最新（2021-04-11）V8的实现（目录地址：v8-src-numbers-）" class="headerlink" title="最新（2021.04.11）V8的实现（目录地址：v8/src/numbers/）"></a>最新（2021.04.11）V8的实现（目录地址：<a href="https://github.com/v8/v8/tree/dc712da548c7fb433caed56af9a021d964952728" target="_blank" rel="noopener">v8</a>/<a href="https://github.com/v8/v8/tree/dc712da548c7fb433caed56af9a021d964952728/src" target="_blank" rel="noopener">src</a>/<a href="https://github.com/v8/v8/tree/dc712da548c7fb433caed56af9a021d964952728/src/numbers" target="_blank" rel="noopener">numbers</a>/）</h5><p>首先来看<code>Math.random()</code>的源码（<a href="https://github.com/v8/v8/tree/dc712da548c7fb433caed56af9a021d964952728" target="_blank" rel="noopener">v8</a>/<a href="https://github.com/v8/v8/tree/dc712da548c7fb433caed56af9a021d964952728/src" target="_blank" rel="noopener">src</a>/<a href="https://github.com/v8/v8/tree/dc712da548c7fb433caed56af9a021d964952728/src/numbers" target="_blank" rel="noopener">numbers</a>/<a href="https://github.com/v8/v8/blob/dc712da548c7fb433caed56af9a021d964952728/src/numbers/math-random.cc" target="_blank" rel="noopener">math-random.cc</a>）：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2018 the V8 project authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></span><br><span class="line"><span class="comment">// found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/numbers/math-random.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/utils/random-number-generator.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/common/assert-scope.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/execution/isolate.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/objects/contexts-inl.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/objects/fixed-array.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/objects/smi.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> v8 &#123;</span><br><span class="line"><span class="keyword">namespace</span> internal &#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MathRandom::InitializeContext</span><span class="params">(Isolate* isolate,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   Handle&lt;Context&gt; native_context)</span> </span>&#123;</span><br><span class="line">  Handle&lt;FixedDoubleArray&gt; cache = Handle&lt;FixedDoubleArray&gt;::cast(</span><br><span class="line">      isolate-&gt;factory()-&gt;NewFixedDoubleArray(kCacheSize));</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; kCacheSize; i++) cache-&gt;<span class="built_in">set</span>(i, <span class="number">0</span>);</span><br><span class="line">  native_context-&gt;set_math_random_cache(*cache);</span><br><span class="line">  Handle&lt;PodArray&lt;State&gt;&gt; pod =</span><br><span class="line">      PodArray&lt;State&gt;::New(isolate, <span class="number">1</span>, AllocationType::kOld);</span><br><span class="line">  native_context-&gt;set_math_random_state(*pod);</span><br><span class="line">  ResetContext(*native_context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MathRandom::ResetContext</span><span class="params">(Context native_context)</span> </span>&#123;</span><br><span class="line">  native_context.set_math_random_index(Smi::zero());</span><br><span class="line">  State state = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">  PodArray&lt;State&gt;::cast(native_context.math_random_state()).<span class="built_in">set</span>(<span class="number">0</span>, state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Address <span class="title">MathRandom::RefillCache</span><span class="params">(Isolate* isolate, Address raw_native_context)</span> </span>&#123;</span><br><span class="line">  Context native_context = Context::cast(Object(raw_native_context));</span><br><span class="line">  DisallowHeapAllocation no_gc;</span><br><span class="line">  PodArray&lt;State&gt; pod =</span><br><span class="line">      PodArray&lt;State&gt;::cast(native_context.math_random_state());</span><br><span class="line">  State state = pod.get(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// Initialize state if not yet initialized. If a fixed random seed was</span></span><br><span class="line">  <span class="comment">// requested, use it to reset our state the first time a script asks for</span></span><br><span class="line">  <span class="comment">// random numbers in this context. This ensures the script sees a consistent</span></span><br><span class="line">  <span class="comment">// sequence.</span></span><br><span class="line">  <span class="keyword">if</span> (state.s0 == <span class="number">0</span> &amp;&amp; state.s1 == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> seed;</span><br><span class="line">    <span class="keyword">if</span> (FLAG_random_seed != <span class="number">0</span>) &#123;</span><br><span class="line">      seed = FLAG_random_seed;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      isolate-&gt;random_number_generator()-&gt;NextBytes(&amp;seed, <span class="keyword">sizeof</span>(seed));</span><br><span class="line">    &#125;</span><br><span class="line">    state.s0 = base::RandomNumberGenerator::MurmurHash3(seed);</span><br><span class="line">    state.s1 = base::RandomNumberGenerator::MurmurHash3(~seed);</span><br><span class="line">    CHECK(state.s0 != <span class="number">0</span> || state.s1 != <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  FixedDoubleArray cache =</span><br><span class="line">      FixedDoubleArray::cast(native_context.math_random_cache());</span><br><span class="line">  <span class="comment">// Create random numbers.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; kCacheSize; i++) &#123;</span><br><span class="line">    <span class="comment">// Generate random numbers using xorshift128+.</span></span><br><span class="line">    base::RandomNumberGenerator::XorShift128(&amp;state.s0, &amp;state.s1);</span><br><span class="line">    cache.<span class="built_in">set</span>(i, base::RandomNumberGenerator::ToDouble(state.s0));</span><br><span class="line">  &#125;</span><br><span class="line">  pod.<span class="built_in">set</span>(<span class="number">0</span>, state);</span><br><span class="line"></span><br><span class="line">  Smi new_index = Smi::FromInt(kCacheSize);</span><br><span class="line">  native_context.set_math_random_index(new_index);</span><br><span class="line">  <span class="keyword">return</span> new_index.ptr();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace internal</span></span><br><span class="line">&#125;  <span class="comment">// namespace v8</span></span><br></pre></td></tr></table></figure>
<p>总的来说，此文件与随机数生成相关的主要内容：</p>
<ul>
<li><p>生成和控制随机种子<code>state.s0</code>和<code>state.s1</code>（调用<code>random-number-generator.h</code>的方法：<code>base::RandomNumberGenerator::MurmurHash3(seed)</code>和<code>base::RandomNumberGenerator::MurmurHash3(~seed)</code>）</p>
<ul>
<li><p>*其中seed来源于<a href="https://github.com/v8/v8" target="_blank" rel="noopener">v8</a>/<a href="https://github.com/v8/v8/tree/master/src" target="_blank" rel="noopener">src</a>/<a href="https://github.com/v8/v8/tree/master/src/base" target="_blank" rel="noopener">base</a>/<a href="https://github.com/v8/v8/tree/master/src/base/utils" target="_blank" rel="noopener">utils</a>/<a href="https://github.com/v8/v8/blob/master/src/base/utils/random-number-generator.cc" target="_blank" rel="noopener">random-number-generator.cc</a> ：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int64_t</span> seed = Time::NowFromSystemTime().ToInternalValue() &lt;&lt; <span class="number">24</span>;</span><br><span class="line">  seed ^= TimeTicks::HighResolutionNow().ToInternalValue() &lt;&lt; <span class="number">16</span>;</span><br><span class="line">  seed ^= TimeTicks::Now().ToInternalValue() &lt;&lt; <span class="number">8</span>;</span><br><span class="line">  SetSeed(seed);</span><br></pre></td></tr></table></figure>
<p>即根据时间信息进行位运算处理，所以seed也是一个伪随机数。</p>
</li>
</ul>
</li>
<li><p>调用<code>random-number-generator.h</code>的方法：<code>base::RandomNumberGenerator::XorShift128(&amp;state.s0, &amp;state.s1);</code></p>
</li>
<li><p>设置和控制seed缓存</p>
</li>
</ul>
<p>所以核心生成还是在<a href="https://github.com/v8/v8" target="_blank" rel="noopener">v8</a>/<a href="https://github.com/v8/v8/tree/master/src" target="_blank" rel="noopener">src</a>/<a href="https://github.com/v8/v8/tree/master/src/base" target="_blank" rel="noopener">base</a>/<a href="https://github.com/v8/v8/tree/master/src/base/utils" target="_blank" rel="noopener">utils</a>/<a href="https://github.com/v8/v8/blob/master/src/base/utils/random-number-generator.cc" target="_blank" rel="noopener">random-number-generator.cc</a>文件中：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright 2013 the V8 project authors. All rights reserved.</span></span><br><span class="line"><span class="comment">// Use of this source code is governed by a BSD-style license that can be</span></span><br><span class="line"><span class="comment">// found in the LICENSE file.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/utils/random-number-generator.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/bits.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/macros.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/platform/mutex.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/platform/time.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"src/base/platform/wrappers.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> v8 &#123;</span><br><span class="line"><span class="keyword">namespace</span> base &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> LazyMutex entropy_mutex = LAZY_MUTEX_INITIALIZER;</span><br><span class="line"><span class="keyword">static</span> RandomNumberGenerator::EntropySource entropy_source = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// static</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RandomNumberGenerator::SetEntropySource</span><span class="params">(EntropySource source)</span> </span>&#123;</span><br><span class="line">  <span class="function">MutexGuard <span class="title">lock_guard</span><span class="params">(entropy_mutex.Pointer())</span></span>;</span><br><span class="line">  entropy_source = source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RandomNumberGenerator::RandomNumberGenerator() &#123;</span><br><span class="line">  <span class="comment">// Check if embedder supplied an entropy source.</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">MutexGuard <span class="title">lock_guard</span><span class="params">(entropy_mutex.Pointer())</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (entropy_source != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">      <span class="keyword">int64_t</span> seed;</span><br><span class="line">      <span class="keyword">if</span> (entropy_source(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>*&gt;(&amp;seed),</span><br><span class="line">                         <span class="keyword">sizeof</span>(seed))) &#123;</span><br><span class="line">        SetSeed(seed);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> V8_OS_CYGWIN || V8_OS_WIN</span></span><br><span class="line">  <span class="comment">// Use rand_s() to gather entropy on Windows. See:</span></span><br><span class="line">  <span class="comment">// https://code.google.com/p/v8/issues/detail?id=2905</span></span><br><span class="line">  <span class="keyword">unsigned</span> first_half, second_half;</span><br><span class="line">  <span class="keyword">errno_t</span> result = rand_s(&amp;first_half);</span><br><span class="line">  DCHECK_EQ(<span class="number">0</span>, result);</span><br><span class="line">  result = rand_s(&amp;second_half);</span><br><span class="line">  DCHECK_EQ(<span class="number">0</span>, result);</span><br><span class="line">  SetSeed((<span class="keyword">static_cast</span>&lt;<span class="keyword">int64_t</span>&gt;(first_half) &lt;&lt; <span class="number">32</span>) + second_half);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> V8_OS_MACOSX || V8_OS_FREEBSD || V8_OS_OPENBSD</span></span><br><span class="line">  <span class="comment">// Despite its prefix suggests it is not RC4 algorithm anymore.</span></span><br><span class="line">  <span class="comment">// It always succeeds while having decent performance and</span></span><br><span class="line">  <span class="comment">// no file descriptor involved.</span></span><br><span class="line">  <span class="keyword">int64_t</span> seed;</span><br><span class="line">  arc4random_buf(&amp;seed, <span class="keyword">sizeof</span>(seed));</span><br><span class="line">  SetSeed(seed);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="comment">// Gather entropy from /dev/urandom if available.</span></span><br><span class="line">  FILE* fp = base::Fopen(<span class="string">"/dev/urandom"</span>, <span class="string">"rb"</span>);</span><br><span class="line">  <span class="keyword">if</span> (fp != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">    <span class="keyword">int64_t</span> seed;</span><br><span class="line">    <span class="keyword">size_t</span> n = fread(&amp;seed, <span class="keyword">sizeof</span>(seed), <span class="number">1</span>, fp);</span><br><span class="line">    base::Fclose(fp);</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">      SetSeed(seed);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We cannot assume that random() or rand() were seeded</span></span><br><span class="line">  <span class="comment">// properly, so instead of relying on random() or rand(),</span></span><br><span class="line">  <span class="comment">// we just seed our PRNG using timing data as fallback.</span></span><br><span class="line">  <span class="comment">// This is weak entropy, but it's sufficient, because</span></span><br><span class="line">  <span class="comment">// it is the responsibility of the embedder to install</span></span><br><span class="line">  <span class="comment">// an entropy source using v8::V8::SetEntropySource(),</span></span><br><span class="line">  <span class="comment">// which provides reasonable entropy, see:</span></span><br><span class="line">  <span class="comment">// https://code.google.com/p/v8/issues/detail?id=2905</span></span><br><span class="line">  <span class="keyword">int64_t</span> seed = Time::NowFromSystemTime().ToInternalValue() &lt;&lt; <span class="number">24</span>;</span><br><span class="line">  seed ^= TimeTicks::HighResolutionNow().ToInternalValue() &lt;&lt; <span class="number">16</span>;</span><br><span class="line">  seed ^= TimeTicks::Now().ToInternalValue() &lt;&lt; <span class="number">8</span>;</span><br><span class="line">  SetSeed(seed);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// V8_OS_CYGWIN || V8_OS_WIN</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">RandomNumberGenerator::NextInt</span><span class="params">(<span class="keyword">int</span> max)</span> </span>&#123;</span><br><span class="line">  DCHECK_LT(<span class="number">0</span>, max);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Fast path if max is a power of 2.</span></span><br><span class="line">  <span class="keyword">if</span> (bits::IsPowerOfTwo(max)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;((max * <span class="keyword">static_cast</span>&lt;<span class="keyword">int64_t</span>&gt;(Next(<span class="number">31</span>))) &gt;&gt; <span class="number">31</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">int</span> rnd = Next(<span class="number">31</span>);</span><br><span class="line">    <span class="keyword">int</span> val = rnd % max;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">int</span>&gt;::max() - (rnd - val) &gt;= (max - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">RandomNumberGenerator::NextDouble</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  XorShift128(&amp;state0_, &amp;state1_);</span><br><span class="line">  <span class="keyword">return</span> ToDouble(state0_);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int64_t</span> <span class="title">RandomNumberGenerator::NextInt64</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  XorShift128(&amp;state0_, &amp;state1_);</span><br><span class="line">  <span class="keyword">return</span> bit_cast&lt;<span class="keyword">int64_t</span>&gt;(state0_ + state1_);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RandomNumberGenerator::NextBytes</span><span class="params">(<span class="keyword">void</span>* buffer, <span class="keyword">size_t</span> buflen)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> n = <span class="number">0</span>; n &lt; buflen; ++n) &#123;</span><br><span class="line">    <span class="keyword">static_cast</span>&lt;<span class="keyword">uint8_t</span>*&gt;(buffer)[n] = <span class="keyword">static_cast</span>&lt;<span class="keyword">uint8_t</span>&gt;(Next(<span class="number">8</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt; <span class="title">ComplementSample</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_set</span>&lt;<span class="keyword">uint64_t</span>&gt;&amp; <span class="built_in">set</span>, <span class="keyword">uint64_t</span> max)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt; result;</span><br><span class="line">  result.reserve(max - <span class="built_in">set</span>.size());</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">uint64_t</span> i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">set</span>.count(i)) &#123;</span><br><span class="line">      result.push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt; <span class="title">RandomNumberGenerator::NextSample</span><span class="params">(<span class="keyword">uint64_t</span> max,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                        <span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">  CHECK_LE(n, max);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt;();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Choose to select or exclude, whatever needs fewer generator calls.</span></span><br><span class="line">  <span class="keyword">size_t</span> smaller_part = <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(</span><br><span class="line">      <span class="built_in">std</span>::min(max - <span class="keyword">static_cast</span>&lt;<span class="keyword">uint64_t</span>&gt;(n), <span class="keyword">static_cast</span>&lt;<span class="keyword">uint64_t</span>&gt;(n)));</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">unordered_set</span>&lt;<span class="keyword">uint64_t</span>&gt; selected;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">size_t</span> counter = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (selected.size() != smaller_part &amp;&amp; counter / <span class="number">3</span> &lt; smaller_part) &#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> x = <span class="keyword">static_cast</span>&lt;<span class="keyword">uint64_t</span>&gt;(NextDouble() * max);</span><br><span class="line">    CHECK_LT(x, max);</span><br><span class="line"></span><br><span class="line">    selected.insert(x);</span><br><span class="line">    counter++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (selected.size() == smaller_part) &#123;</span><br><span class="line">    <span class="keyword">if</span> (smaller_part != n) &#123;</span><br><span class="line">      <span class="keyword">return</span> ComplementSample(selected, max);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt;(selected.begin(), selected.end());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Failed to select numbers in smaller_part * 3 steps, try different approach.</span></span><br><span class="line">  <span class="keyword">return</span> NextSampleSlow(max, n, selected);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt; <span class="title">RandomNumberGenerator::NextSampleSlow</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">uint64_t</span> max, <span class="keyword">size_t</span> n, <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_set</span>&lt;<span class="keyword">uint64_t</span>&gt;&amp; excluded)</span> </span>&#123;</span><br><span class="line">  CHECK_GE(max - excluded.size(), n);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">uint64_t</span>&gt; result;</span><br><span class="line">  result.reserve(max - excluded.size());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">uint64_t</span> i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!excluded.count(i)) &#123;</span><br><span class="line">      result.push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Decrease result vector until it contains values to select or exclude,</span></span><br><span class="line">  <span class="comment">// whatever needs fewer generator calls.</span></span><br><span class="line">  <span class="keyword">size_t</span> larger_part = <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(</span><br><span class="line">      <span class="built_in">std</span>::max(max - <span class="keyword">static_cast</span>&lt;<span class="keyword">uint64_t</span>&gt;(n), <span class="keyword">static_cast</span>&lt;<span class="keyword">uint64_t</span>&gt;(n)));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Excluded set may cause that initial result is already smaller than</span></span><br><span class="line">  <span class="comment">// larget_part.</span></span><br><span class="line">  <span class="keyword">while</span> (result.size() != larger_part &amp;&amp; result.size() &gt; n) &#123;</span><br><span class="line">    <span class="keyword">size_t</span> x = <span class="keyword">static_cast</span>&lt;<span class="keyword">size_t</span>&gt;(NextDouble() * result.size());</span><br><span class="line">    CHECK_LT(x, result.size());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::swap(result[x], result.back());</span><br><span class="line">    result.pop_back();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (result.size() != n) &#123;</span><br><span class="line">    <span class="keyword">return</span> ComplementSample(</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">unordered_set</span>&lt;<span class="keyword">uint64_t</span>&gt;(result.begin(), result.end()), max);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">RandomNumberGenerator::Next</span><span class="params">(<span class="keyword">int</span> bits)</span> </span>&#123;</span><br><span class="line">  DCHECK_LT(<span class="number">0</span>, bits);</span><br><span class="line">  DCHECK_GE(<span class="number">32</span>, bits);</span><br><span class="line">  XorShift128(&amp;state0_, &amp;state1_);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;((state0_ + state1_) &gt;&gt; (<span class="number">64</span> - bits));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RandomNumberGenerator::SetSeed</span><span class="params">(<span class="keyword">int64_t</span> seed)</span> </span>&#123;</span><br><span class="line">  initial_seed_ = seed;</span><br><span class="line">  state0_ = MurmurHash3(bit_cast&lt;<span class="keyword">uint64_t</span>&gt;(seed));</span><br><span class="line">  state1_ = MurmurHash3(~state0_);</span><br><span class="line">  CHECK(state0_ != <span class="number">0</span> || state1_ != <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint64_t</span> <span class="title">RandomNumberGenerator::MurmurHash3</span><span class="params">(<span class="keyword">uint64_t</span> h)</span> </span>&#123;</span><br><span class="line">  h ^= h &gt;&gt; <span class="number">33</span>;</span><br><span class="line">  h *= <span class="keyword">uint64_t</span>&#123;<span class="number">0xFF51AFD7ED558CCD</span>&#125;;</span><br><span class="line">  h ^= h &gt;&gt; <span class="number">33</span>;</span><br><span class="line">  h *= <span class="keyword">uint64_t</span>&#123;<span class="number">0xC4CEB9FE1A85EC53</span>&#125;;</span><br><span class="line">  h ^= h &gt;&gt; <span class="number">33</span>;</span><br><span class="line">  <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace base</span></span><br><span class="line">&#125;  <span class="comment">// namespace v8</span></span><br></pre></td></tr></table></figure>
<p>可以看出核心是XorShift128+ 算法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">XorShift128</span><span class="params">(<span class="keyword">uint64_t</span>* state0, <span class="keyword">uint64_t</span>* state1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> s1 = *state0;</span><br><span class="line">    <span class="keyword">uint64_t</span> s0 = *state1;</span><br><span class="line">    *state0 = s0;</span><br><span class="line">    s1 ^= s1 &lt;&lt; <span class="number">23</span>;</span><br><span class="line">    s1 ^= s1 &gt;&gt; <span class="number">17</span>;</span><br><span class="line">    s1 ^= s0;</span><br><span class="line">    s1 ^= s0 &gt;&gt; <span class="number">26</span>;</span><br><span class="line">    *state1 = s1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它使用128位内部状态，周期长度为<code>2^128 - 1</code>，并且 XorShift128+ 通过了TestU01的所有测试。</p>
<p>不过更新之后仍然会存在“密码学安全伪随机数生成”的危险，并且对于诸如散列、签名生成和加解密之类的用例，普通的PRNG不合适。因此便有了下面的模块。</p>
<h5 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h5><p>为了解决上述问题，浏览器和node提供了解决方案：</p>
<p>1.浏览器环境（webkit）：安全变量API——crypto，<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/crypto" target="_blank" rel="noopener">window.crypto.getRandomValues</a></p>
<p>兼容情况：总体兼容较好</p>
<ul>
<li>移动：iOS8起步，Android5起步</li>
<li>PC：IE11，Chrome37起步</li>
</ul>
<p><img src="/images/random/p-6.png" alt="p-6.png"></p>
<p>2.nodejs环境：加密模块-crypto，<a href="https://nodejs.org/docs/latest-v10.x/api/crypto.html#crypto_crypto_randomfill_buffer_offset_size_callback" target="_blank" rel="noopener">crypto.randomFill</a></p>
<p>兼容情况：此方法或替代方法在v4.x的文档中也能看到，所以几乎没有兼容问题。</p>
<p>这两种方式的使用方式本文不做介绍，它们为了确保足够的性能，不使用真正的随机数生成器，而是使用具有足够高质量的熵值作为伪随机数生成器的种子，如操作系统熵源（如<code>&quot;/dev/urandom&quot;</code>）。</p>
<p>它们都是牺牲性能成本返回加密安全随机值的方法，像<a href="https://www.npmjs.com/package/uuid" target="_blank" rel="noopener">uuid</a>就用到了它们。</p>
<blockquote>
<p>基于webkit的浏览器（Chrome、Safari）似乎使用基于ARC4的RNG，该RNG丢弃早期的密钥流，并每隔1.5mb混合系统OS熵。</p>
</blockquote>
<p>webkit加密模块代码（<code>/Source/WebCore/page/Crypto.cpp</code>）：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2011 Google Inc. All rights reserved.</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2013 Apple Inc. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"> * modification, are permitted provided that the following conditions</span></span><br><span class="line"><span class="comment"> * are met:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1.  Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer. </span></span><br><span class="line"><span class="comment"> * 2.  Redistributions in binary form must reproduce the above copyright</span></span><br><span class="line"><span class="comment"> *     notice, this list of conditions and the following disclaimer in the</span></span><br><span class="line"><span class="comment"> *     documentation and/or other materials provided with the distribution. </span></span><br><span class="line"><span class="comment"> * 3.  Neither the name of Google, Inc. ("Google") nor the names of</span></span><br><span class="line"><span class="comment"> *     its contributors may be used to endorse or promote products derived</span></span><br><span class="line"><span class="comment"> *     from this software without specific prior written permission. </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY GOOGLE AND ITS CONTRIBUTORS "AS IS" AND ANY</span></span><br><span class="line"><span class="comment"> * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span></span><br><span class="line"><span class="comment"> * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></span><br><span class="line"><span class="comment"> * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY</span></span><br><span class="line"><span class="comment"> * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span></span><br><span class="line"><span class="comment"> * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span></span><br><span class="line"><span class="comment"> * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span></span><br><span class="line"><span class="comment"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></span><br><span class="line"><span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span></span><br><span class="line"><span class="comment"> * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"config.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Crypto.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Document.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"SubtleCrypto.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;JavaScriptCore/ArrayBufferView.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wtf/CryptographicallyRandomNumber.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> OS(DARWIN)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;CommonCrypto/CommonCryptor.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;CommonCrypto/CommonRandom.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> WebCore &#123;</span><br><span class="line"></span><br><span class="line">Crypto::Crypto(ScriptExecutionContext* context)</span><br><span class="line">    : ContextDestructionObserver(context)</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ENABLE(WEB_CRYPTO)</span></span><br><span class="line">    , m_subtle(SubtleCrypto::create(context))</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Crypto::~Crypto() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ExceptionOr&lt;<span class="keyword">void</span>&gt; <span class="title">Crypto::getRandomValues</span><span class="params">(ArrayBufferView&amp; <span class="built_in">array</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!isInt(<span class="built_in">array</span>.getType()))</span><br><span class="line">        <span class="keyword">return</span> Exception &#123; TypeMismatchError &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">array</span>.byteLength() &gt; <span class="number">65536</span>)</span><br><span class="line">        <span class="keyword">return</span> Exception &#123; QuotaExceededError &#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> OS(DARWIN)</span></span><br><span class="line">    <span class="keyword">auto</span> rc = CCRandomGenerateBytes(<span class="built_in">array</span>.baseAddress(), <span class="built_in">array</span>.byteLength());</span><br><span class="line">    RELEASE_ASSERT(rc == kCCSuccess);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    cryptographicallyRandomValues(<span class="built_in">array</span>.baseAddress(), <span class="built_in">array</span>.byteLength());</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> &#123; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ENABLE(WEB_CRYPTO)</span></span><br><span class="line"></span><br><span class="line"><span class="function">SubtleCrypto&amp; <span class="title">Crypto::subtle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> m_subtle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出核心是调用了<code>wtf/CryptographicallyRandomNumber.h</code>的<code>cryptographicallyRandomValues</code>方法。</p>
<p>加密实现可见<code>Source/WTF/wtf/CryptographicallyRandomNumber.cpp</code>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright (c) 1996, David Mazieres &lt;dm@uun.org&gt;</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2008, Damien Miller &lt;djm@openbsd.org&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Permission to use, copy, modify, and distribute this software for any</span></span><br><span class="line"><span class="comment"> * purpose with or without fee is hereby granted, provided that the above</span></span><br><span class="line"><span class="comment"> * copyright notice and this permission notice appear in all copies.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span></span><br><span class="line"><span class="comment"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span></span><br><span class="line"><span class="comment"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span></span><br><span class="line"><span class="comment"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span></span><br><span class="line"><span class="comment"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span></span><br><span class="line"><span class="comment"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span></span><br><span class="line"><span class="comment"> * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Arc4 random number generator for OpenBSD.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This code is derived from section 17.1 of Applied Cryptography,</span></span><br><span class="line"><span class="comment"> * second edition, which describes a stream cipher allegedly</span></span><br><span class="line"><span class="comment"> * compatible with RSA Labs "RC4" cipher (the actual description of</span></span><br><span class="line"><span class="comment"> * which is a trade secret).  The same algorithm is used as a stream</span></span><br><span class="line"><span class="comment"> * cipher called "arcfour" in Tatu Ylonen's ssh package.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * RC4 is a registered trademark of RSA Laboratories.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"config.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wtf/CryptographicallyRandomNumber.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wtf/Lock.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wtf/NeverDestroyed.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;wtf/OSRandomSource.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> WTF &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ARC4Stream</span> &#123;</span></span><br><span class="line">    WTF_MAKE_FAST_ALLOCATED;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ARC4Stream();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint8_t</span> i;</span><br><span class="line">    <span class="keyword">uint8_t</span> j;</span><br><span class="line">    <span class="keyword">uint8_t</span> s[<span class="number">256</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ARC4RandomNumberGenerator</span> &#123;</span></span><br><span class="line">    WTF_MAKE_FAST_ALLOCATED;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ARC4RandomNumberGenerator();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">uint32_t</span> <span class="title">randomNumber</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">randomValues</span><span class="params">(<span class="keyword">void</span>* buffer, <span class="keyword">size_t</span> length)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addRandomData</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *data, <span class="keyword">int</span> length)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stir</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">stirIfNeeded</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">uint8_t</span> <span class="title">getByte</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">uint32_t</span> <span class="title">getWord</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    ARC4Stream m_stream;</span><br><span class="line">    <span class="keyword">int</span> m_count;</span><br><span class="line">    Lock m_mutex;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ARC4Stream::ARC4Stream()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; <span class="number">256</span>; n++)</span><br><span class="line">        s[n] = n;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ARC4RandomNumberGenerator::ARC4RandomNumberGenerator()</span><br><span class="line">    : m_count(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ARC4RandomNumberGenerator::addRandomData</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* data, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_stream.i--;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; <span class="number">256</span>; n++) &#123;</span><br><span class="line">        m_stream.i++;</span><br><span class="line">        <span class="keyword">uint8_t</span> si = m_stream.s[m_stream.i];</span><br><span class="line">        m_stream.j += si + data[n % length];</span><br><span class="line">        m_stream.s[m_stream.i] = m_stream.s[m_stream.j];</span><br><span class="line">        m_stream.s[m_stream.j] = si;</span><br><span class="line">    &#125;</span><br><span class="line">    m_stream.j = m_stream.i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ARC4RandomNumberGenerator::stir</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> randomness[<span class="number">128</span>];</span><br><span class="line">    <span class="keyword">size_t</span> length = <span class="keyword">sizeof</span>(randomness);</span><br><span class="line">    cryptographicallyRandomValuesFromOS(randomness, length);</span><br><span class="line">    addRandomData(randomness, length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Discard early keystream, as per recommendations in:</span></span><br><span class="line">    <span class="comment">// http://www.wisdom.weizmann.ac.il/~itsik/RC4/Papers/Rc4_ksa.ps</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">        getByte();</span><br><span class="line">    m_count = <span class="number">1600000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ARC4RandomNumberGenerator::stirIfNeeded</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (m_count &lt;= <span class="number">0</span>)</span><br><span class="line">        stir();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint8_t</span> <span class="title">ARC4RandomNumberGenerator::getByte</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_stream.i++;</span><br><span class="line">    <span class="keyword">uint8_t</span> si = m_stream.s[m_stream.i];</span><br><span class="line">    m_stream.j += si;</span><br><span class="line">    <span class="keyword">uint8_t</span> sj = m_stream.s[m_stream.j];</span><br><span class="line">    m_stream.s[m_stream.i] = sj;</span><br><span class="line">    m_stream.s[m_stream.j] = si;</span><br><span class="line">    <span class="keyword">return</span> (m_stream.s[(si + sj) &amp; <span class="number">0xff</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">ARC4RandomNumberGenerator::getWord</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> val;</span><br><span class="line">    val = getByte() &lt;&lt; <span class="number">24</span>;</span><br><span class="line">    val |= getByte() &lt;&lt; <span class="number">16</span>;</span><br><span class="line">    val |= getByte() &lt;&lt; <span class="number">8</span>;</span><br><span class="line">    val |= getByte();</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">ARC4RandomNumberGenerator::randomNumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> locker = holdLock(m_mutex);</span><br><span class="line"></span><br><span class="line">    m_count -= <span class="number">4</span>;</span><br><span class="line">    stirIfNeeded();</span><br><span class="line">    <span class="keyword">return</span> getWord();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ARC4RandomNumberGenerator::randomValues</span><span class="params">(<span class="keyword">void</span>* buffer, <span class="keyword">size_t</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> locker = holdLock(m_mutex);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span>* result = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">char</span>*&gt;(buffer);</span><br><span class="line">    stirIfNeeded();</span><br><span class="line">    <span class="keyword">while</span> (length--) &#123;</span><br><span class="line">        m_count--;</span><br><span class="line">        stirIfNeeded();</span><br><span class="line">        result[length] = getByte();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ARC4RandomNumberGenerator&amp; <span class="title">sharedRandomNumberGenerator</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> LazyNeverDestroyed&lt;ARC4RandomNumberGenerator&gt; randomNumberGenerator;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">std</span>::once_flag onceFlag;</span><br><span class="line">    <span class="built_in">std</span>::call_once(</span><br><span class="line">        onceFlag,</span><br><span class="line">        [] &#123;</span><br><span class="line">            randomNumberGenerator.construct();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> randomNumberGenerator;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">uint32_t</span> <span class="title">cryptographicallyRandomNumber</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sharedRandomNumberGenerator().randomNumber();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cryptographicallyRandomValues</span><span class="params">(<span class="keyword">void</span>* buffer, <span class="keyword">size_t</span> length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    sharedRandomNumberGenerator().randomValues(buffer, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相比<code>Math.random()</code>，可以看出crypto的实现更为复杂，且有os依赖。</p>
<blockquote>
<p>笔者也发现了webkit中如WebRtc单独实现了随机算法，其复杂度介于crypto和Math.random()之间，有兴趣可以去看一看<code>/Source/webrtc/rtc_base/helpers.cc</code>文件</p>
</blockquote>
<p>后续我们随性用js写几个前文PRNG的js实现（虽然几乎毫无实际意义）：</p>
<h5 id="简易实现随机数"><a href="#简易实现随机数" class="headerlink" title="简易实现随机数"></a>简易实现随机数</h5><p>方法1：MWC1616</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Utils = &#123;</span><br><span class="line">  state0: <span class="number">1</span>,</span><br><span class="line">  state1: <span class="number">2</span>,</span><br><span class="line">  getRandom: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> state0 = Utils.state0;</span><br><span class="line">    <span class="keyword">let</span> state1 = Utils.state1;</span><br><span class="line">    Utils.state0 = state0 = <span class="number">18030</span> * (state0 &amp; <span class="number">0xffff</span>) + (state0 &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    Utils.state1 = state1 = <span class="number">30903</span> * (state1 &amp; <span class="number">0xffff</span>) + (state1 &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> state0 &lt;&lt; <span class="number">16</span> + (state1 &amp; <span class="number">0xffff</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// use:</span></span><br><span class="line"><span class="comment">// Utils.getRandom();</span></span><br></pre></td></tr></table></figure>
<p>方法2：XorShift</p>
<ul>
<li><a href="https://www.npmjs.com/package/xorshift" target="_blank" rel="noopener">npm-xorshift</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Utils = &#123;</span><br><span class="line">    t: <span class="literal">undefined</span>,</span><br><span class="line">    x: <span class="number">123456789</span>, </span><br><span class="line">    y: <span class="number">362436069</span>, </span><br><span class="line">    z: <span class="number">521288629</span>,</span><br><span class="line">    getRandom () &#123;</span><br><span class="line">        <span class="keyword">let</span> x = Utils.x;</span><br><span class="line">        x ^= x &lt;&lt; <span class="number">16</span>;</span><br><span class="line">        x ^= x &gt;&gt; <span class="number">5</span>;</span><br><span class="line">        x ^= x &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">        Utils.t = x;</span><br><span class="line">        Utils.x = Utils.y;</span><br><span class="line">        Utils.y = Utils.z;</span><br><span class="line">        Utils.z = Utils.t ^ Utils.x ^ Utils.y;</span><br><span class="line">        <span class="keyword">return</span> Utils.z;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法3: XorShift128+</p>
<ul>
<li><a href="https://www.npmjs.com/package/xorshift128plus" target="_blank" rel="noopener">https://www.npmjs.com/package/xorshift128plus</a></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Utils = &#123;</span><br><span class="line">  state0: <span class="number">1</span>,</span><br><span class="line">  state1: <span class="number">2</span>,</span><br><span class="line">  getRandom () &#123;</span><br><span class="line">    <span class="keyword">let</span> s1 = Utils.state0;</span><br><span class="line">    <span class="keyword">let</span> s0 = Utils.state1;</span><br><span class="line">    Utils.state0 = s0;</span><br><span class="line">    s1 ^= s1 &lt;&lt; <span class="number">23</span>;</span><br><span class="line">    s1 ^= s1 &gt;&gt; <span class="number">17</span>;</span><br><span class="line">    s1 ^= s0;</span><br><span class="line">    s1 ^= s0 &gt;&gt; <span class="number">26</span>;</span><br><span class="line">    Utils.state1 = s1;</span><br><span class="line">    <span class="keyword">return</span> Utils.state0 + Utils.state1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>本文的篇幅较长，总结一下主要内容：</p>
<ul>
<li>1.随机数/随机序列的介绍、作用、定义；</li>
<li>2.一些常见的随机算法及检测工具介绍；</li>
<li>3.V8引擎的算法改进</li>
<li>4.随机算法的js实现</li>
</ul>
<p>最后引入一句名言：</p>
<blockquote>
<p>Any one who considers arithmetical methods of producing random digits is , of course, in a state of sin.        ——JOHN VON NEUMANN, 1951</p>
</blockquote>
<hr>
<h4 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h4><ul>
<li><a href="http://www.math.sci.hiroshima-u.ac.jp/m-mat/MT/emt.html" target="_blank" rel="noopener">http://www.math.sci.hiroshima-u.ac.jp/m-mat/MT/emt.html</a></li>
<li><a href="https://link.zhihu.com/?target=https%3A//www.bsi.bund.de/cae/servlet/contentblob/478152/publicationFile/30552/ais20e_pdf.pdf" target="_blank" rel="noopener">https://link.zhihu.com/?target=https%3A//www.bsi.bund.de/cae/servlet/contentblob/478152/publicationFile/30552/ais20e_pdf.pdf</a></li>
<li><a href="https://www.cnblogs.com/houkai/p/3807041.html" target="_blank" rel="noopener">https://www.cnblogs.com/houkai/p/3807041.html</a></li>
<li><a href="https://www.w3cplus.com/javascript/tifu-by-using-math-random.html" target="_blank" rel="noopener">https://www.w3cplus.com/javascript/tifu-by-using-math-random.html</a></li>
<li><a href="http://v8project.blogspot.tw/2015/12/theres-mathrandom-and-then-theres.html" target="_blank" rel="noopener">http://v8project.blogspot.tw/2015/12/theres-mathrandom-and-then-theres.html</a></li>
<li><a href="http://simul.iro.umontreal.ca/testu01/tu01.html" target="_blank" rel="noopener">http://simul.iro.umontreal.ca/testu01/tu01.html</a></li>
<li><a href="http://simul.iro.umontreal.ca/testu01/guideshorttestu01.pdf" target="_blank" rel="noopener">http://simul.iro.umontreal.ca/testu01/guideshorttestu01.pdf</a></li>
<li><a href="https://www.javamex.com/tutorials/random_numbers/multiply_with_carry.shtml" target="_blank" rel="noopener">https://www.javamex.com/tutorials/random_numbers/multiply_with_carry.shtml</a></li>
<li><a href="https://en.wikipedia.org/wiki/Multiply-with-carry_pseudorandom_number_generator" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Multiply-with-carry_pseudorandom_number_generator</a></li>
<li><a href="http://www.helsbreth.org/random/rng_mwc1616.html" target="_blank" rel="noopener">http://www.helsbreth.org/random/rng_mwc1616.html</a></li>
<li><a href="https://en.wikipedia.org/wiki/Xorshift" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Xorshift</a></li>
<li><a href="https://book.douban.com/subject/2380786/" target="_blank" rel="noopener">《计算机程序设计艺术（第二卷）》</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E7%BA%BF%E6%80%A7%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E7%BA%BF%E6%80%A7%E5%8F%8D%E9%A6%88%E7%A7%BB%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8</a></li>
<li><a href="https://en.wikipedia.org/wiki/Multiply-with-carry" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Multiply-with-carry</a></li>
<li><a href="https://github.com/v8/v8/tree/master/src" target="_blank" rel="noopener">https://github.com/v8/v8/tree/master/src</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83</a></li>
<li><a href="http://www.voidcn.com/article/p-ddubmgpj-bbw.html" target="_blank" rel="noopener">http://www.voidcn.com/article/p-ddubmgpj-bbw.html</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/crypto" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Window/crypto</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E5%99%A8" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90%E5%99%A8</a></li>
<li><a href="https://www.pcg-random.org/pdf/toms-oneill-pcg-family-v1.02.pdf" target="_blank" rel="noopener">https://www.pcg-random.org/pdf/toms-oneill-pcg-family-v1.02.pdf</a></li>
</ul>
</div></article></div><div class="post-paginator"><div class="post-links"><div class="post-prev"><a href="/2021/05/03/tools_study/【工具】界面引导库driverjs/" class="prev">上一篇<span>【工具】界面引导库driverjs</span></a></div><div class="post-next"><a href="/2021/03/21/tools/【工具】英文邮件常用缩写/" class="next">下一篇<span>【工具】英文常用缩写</span></a></div></div></div></div><div class="sidebar"><div class="social-links"><ul><li class="social-link"><a href="http://github.com/MichealWayne" target="_blank" class="link-github"><i class="icon icon-github"></i></a></li><li class="social-link"><a href="mailto:michealwayne@163.com" target="_self" class="link-mail"><i class="icon icon-mail"></i></a></li></ul></div><div class="recent-posts widget"><h3 class="widget-title"> 近期文章</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/04/26/notes/【笔记】web黑夜模式适配/">【笔记】web 黑夜模式通用适配方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/15/ai/【笔记】19届阿里D2终端技术大会纪要/">【笔记】19届阿里D2终端技术大会纪要</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/02/22/ai/【笔记】Lovable提示词指南/">【笔记】Lovable提示词指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/01/19/ai/【调研】AI 编程工具WindSurf使用技巧——WindsurfRules配置/">【调研】AI 编程工具WindSurf使用技巧——WindsurfRules配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/01/05/ai/【笔记】MCP 协议：连接 AI 模型与外部世界的桥梁/">【AI】【笔记】MCP 协议：连接 AI 模型与外部世界的桥梁</a></li></ul></div></div><div class="recent-comment widget"><h3 class="widget-title"> Author</h3><div class="widget-content"><div class="m-author"><div class="u-avatar"><img src="data:image/jpeg;base64,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"></div><div class="u-author_tit"><p>My name is Micheal Wayne and this is my blog.<br>I am a front-end software engineer.<br>Contact: <a href="mailto:michealwayne@163.com"> <span>michealwayne@163.com</span></a></p></div></div></div></div><div class="tag-lists widget"><h3 class="widget-title"> 标签</h3><div class="widget-content"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/APM/">APM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BOM/">BOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bun/">Bun</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OKR/">OKR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UML/">UML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UX/">UX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebApi/">WebApi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zepto/">Zepto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ai/">ai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es/">es</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eslint/">eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lerna/">lerna</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lottie/">lottie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prettier/">prettier</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prompt/">prompt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwa/">pwa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sketch/">sketch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skywalking/">skywalking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/taro/">taro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tslint/">tslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webApi/">webApi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码规范/">代码规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动效/">动效</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图形/">图形</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工程/">工程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微前端/">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/思维逻辑/">思维逻辑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能/">性能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/插件/">插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日常工作/">日常工作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/概念/">概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则/">正则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器/">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/用户体验/">用户体验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编码/">编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络协议/">网络协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/规范/">规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/调试/">调试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/质量/">质量</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨端/">跨端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件/">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件工程/">软件工程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目管理/">项目管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高并发/">高并发</a></li></ul></div></div><div class="archive-lists widget"><h3 class="widget-title"> 归档</h3><div class="widget-content"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/04/">April 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">5</span></li></ul></div></div></div></div></div><footer><div class="copyright"><div class="container"><div class="col-6"><div class="site-info">© 2016 - 2025 <a href="http://blog.michealwayne.cn">Micheal Wayne</a></div></div><div class="col-6"><div class="site-contact"><div class="social-links"><ul><li class="social-link"><a href="http://github.com/MichealWayne" target="_blank" class="link-github"><i class="icon icon-github"></i></a></li><li class="social-link"><a href="mailto:michealwayne@163.com" target="_self" class="link-mail"><i class="icon icon-mail"></i></a></li></ul></div></div></div></div></div></footer><a class="scroll-up"><span class="icon icon-up"></span></a><script src="https://code.jquery.com/jquery-3.1.0.min.js"></script><script src="/js/posfixed.js"></script><script src="/js/utils.js"></script><script src="/js/search.js"></script></body></html>