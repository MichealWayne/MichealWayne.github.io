<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 【笔记】React钩子封装记录（持续） | Wayne的博客</title><meta name="description" content="【笔记】React钩子封装记录（持续） - Micheal Wayne"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/scss/casual.css"><link rel="stylesheet" href="/css/icon.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.michealwayne.cn/atom.xml" title="Wayne的博客"></head><script>(function (w) {w.frontjsConfig={token:"81a82620fb0dca7680f2f06be134fa4f",behaviour:8,FPSThreshold:10};w.frontjsTmpData = {r:[],e:[],l:[]};w.frontjsTmpCollector = function (ev) {(ev.message ? window.frontjsTmpData.e : window.frontjsTmpData.r).push([new Date().getTime(), ev])};w.FrontJS = {addEventListener: function (t, f) {w.frontjsTmpData.l.push([t, f]);return f;},removeEventListener: function (t, f) {for (var i = 0; i < w.frontjsTmpData.l.length; i++) {t === w.frontjsTmpData.l[i][0] && f === w.frontjsTmpData.l[i][1] && w.frontjsTmpData.l.splice(i, 1);}return f;}};w.document.addEventListener("error", w.frontjsTmpCollector, true);w.addEventListener("error", w.frontjsTmpCollector, true);w.addEventListener("load", function () {var n = w.document.createElement("script");n.src = "https://frontjs-static.pgyer.com/dist/current/frontjs.web.min.js"; w.document.body.appendChild(n);}, true);})(window);</script><body><div class="header"><header class="site-header"><div class="site-nav"><span class="button-toggle"></span><div class="container"><div class="nav-item"><a href="/" target="_self" data-text="home">Home</a></div><div class="nav-item"><a href="/archives" target="_self" data-text="archive">Archive</a></div><div class="nav-item"><a href="/about" target="_self" data-text="about">About</a></div></div><form id="search-form" class="nav-item"><input type="text" id="local-search-input" name="q" results="0" placeholder="search" autocomplete="off" autocorrect="off" class="search form-control"><span onclick="resetSearch()" class="fa fa-times"> </span></form><div id="local-search-result"></div><p class="no-result">No results found</p></div></header></div><div class="main"><div class="container"><div class="content"><div class="post"><article class="post-block"><h1 class="post-title">【笔记】React钩子封装记录（持续）</h1><span class="post-date">Aug 9, 2020</span><span class="post-tag"><a href="/tags/笔记/">笔记</a><a href="/tags/js/">js</a><a href="/tags/react/">react</a></span><img src="/images/icons/react.png" class="bgimage"><div class="post-content"><h1 id="React钩子封装记录"><a href="#React钩子封装记录" class="headerlink" title="React钩子封装记录"></a>React钩子封装记录</h1><h2 id="react-use"><a href="#react-use" class="headerlink" title="react-use"></a><a href="https://www.npmjs.com/package/react-use" target="_blank" rel="noopener">react-use</a></h2><h3 id="副作用钩子"><a href="#副作用钩子" class="headerlink" title="副作用钩子"></a>副作用钩子</h3><h4 id="useTitle"><a href="#useTitle" class="headerlink" title="useTitle"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useTitle.md" target="_blank" rel="noopener">useTitle</a></h4><p>用于设置导航栏标题。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useTitle(title, options)</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>title：{String}，标题文案</li>
<li>options：{Object}，参数，可选<ul>
<li>restoreOnUnmount：{Boolean}是否退出还原标题</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useTitle&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  useTitle(<span class="string">'Hello title!'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析"><a href="#源码及解析" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useTitle.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">export</span> interface UseTitleOptions &#123;</span><br><span class="line">  restoreOnUnmount?: boolean;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> DEFAULT_USE_TITLE_OPTIONS: UseTitleOptions = &#123;</span><br><span class="line">  restoreOnUnmount: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTitle</span>(<span class="params">title: string, options: UseTitleOptions = DEFAULT_USE_TITLE_OPTIONS</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> prevTitleRef = useRef(<span class="built_in">document</span>.title);</span><br><span class="line">  <span class="built_in">document</span>.title = title;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (options &amp;&amp; options.restoreOnUnmount) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.title = prevTitleRef.current;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">typeof</span> <span class="built_in">document</span> !== <span class="string">'undefined'</span> ? useTitle : <span class="function">(<span class="params">_title: string</span>) =&gt;</span> &#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>其中主要是利用<code>document.title</code>来设置页面标题，还原标题则是借助ref来进行旧标题暂存。</p>
<h4 id="useCookie"><a href="#useCookie" class="headerlink" title="useCookie"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useCookie.md" target="_blank" rel="noopener">useCookie</a></h4><p>用于cookie的处理。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [value, updateCookie, deleteCookie] = useTitle(cookieName)</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>cookieName{String}，cookie标识</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCookie &#125; <span class="keyword">from</span> <span class="string">"react-use"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, updateCookie, deleteCookie] = useCookie(<span class="string">"my-cookie"</span>);</span><br><span class="line">  <span class="keyword">const</span> [counter, setCounter] = useState(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    deleteCookie();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> updateCookieHandler = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    updateCookie(<span class="string">`my-awesome-cookie-<span class="subst">$&#123;counter&#125;</span>`</span>);</span><br><span class="line">    setCounter(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;Value: &#123;value&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;updateCookieHandler&#125;&gt;Update Cookie&lt;/</span>button&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;deleteCookie&#125;&gt;Delete Cookie&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-1"><a href="#源码及解析-1" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useCookie.ts</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useState, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">'js-cookie'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCookie = (</span><br><span class="line">  cookieName: string</span><br><span class="line">): [string | <span class="literal">null</span>, (newValue: string, options?: Cookies.CookieAttributes) =&gt; <span class="keyword">void</span>, () =&gt; <span class="keyword">void</span>] =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string | <span class="literal">null</span>&gt;<span class="function">(<span class="params">(</span>) =&gt;</span> Cookies.get(cookieName) || <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> updateCookie = useCallback(</span><br><span class="line">    (newValue: string, options?: Cookies.CookieAttributes) =&gt; &#123;</span><br><span class="line">      Cookies.set(cookieName, newValue, options);</span><br><span class="line">      setValue(newValue);</span><br><span class="line">    &#125;,</span><br><span class="line">    [cookieName]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> deleteCookie = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    Cookies.remove(cookieName);</span><br><span class="line">    setValue(<span class="literal">null</span>);</span><br><span class="line">  &#125;, [cookieName]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [value, updateCookie, deleteCookie];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCookie;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.核心的cookie操作是基于<a href="https://github.com/js-cookie/js-cookie" target="_blank" rel="noopener">js-cookie</a>这个封装库</li>
<li>2.通过useState控制cookie的取值状态</li>
</ul>
<h4 id="useLocalStorage"><a href="#useLocalStorage" class="headerlink" title="useLocalStorage"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useLocalStorage.md" target="_blank" rel="noopener">useLocalStorage</a></h4><p>用于localStorage的处理。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const [value, setValue, remove] = useLocalStorage(key, initialValue, &#123;</span><br><span class="line">  raw: false,</span><br><span class="line">  serializer: (value: T) =&gt; string,</span><br><span class="line">  deserializer: (value: string) =&gt; T,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>key：{String}，storage标识</li>
<li>initialValue：{any}，storage值</li>
<li>options：参数，可选<ul>
<li>raw：{Boolean}，是否自定义加工处理。默认<code>false</code>，为JSON.stringify/JSON.parse。</li>
<li>serializer：{Function}，当<code>options.raw</code>为<code>true</code>时生效，设置storage值的加工函数</li>
<li>deserializer：{Function}，当<code>options.raw</code>为<code>true</code>时生效，读取storage值的加工函数</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useLocalStorage &#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue, remove] = useLocalStorage(<span class="string">'my-key'</span>, <span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Value: &#123;value&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setValue('bar')&#125;&gt;bar&lt;/</span>button&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setValue(<span class="string">'baz'</span>)&#125;&gt;baz&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; remove()&#125;&gt;Remove&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-2"><a href="#源码及解析-2" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useLocalStorage.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useState, useCallback, Dispatch, SetStateAction &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isClient &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;</span><br><span class="line"></span><br><span class="line">type parserOptions&lt;T&gt; =</span><br><span class="line">  | &#123;</span><br><span class="line">      raw: <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  | &#123;</span><br><span class="line">      raw: <span class="literal">false</span>;</span><br><span class="line">      serializer: <span class="function">(<span class="params">value: T</span>) =&gt;</span> string;</span><br><span class="line">      deserializer: <span class="function">(<span class="params">value: string</span>) =&gt;</span> T;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> noop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useLocalStorage = <span class="xml"><span class="tag">&lt;<span class="name">T</span>&gt;</span>(</span></span><br><span class="line"><span class="xml">  key: string,</span></span><br><span class="line"><span class="xml">  initialValue?: T,</span></span><br><span class="line">  options?: parserOptions&lt;T&gt;</span><br><span class="line">): [T | undefined, Dispatch&lt;SetStateAction&lt;T | undefined&gt;&gt;, () =&gt; void] =&gt; &#123;</span><br><span class="line">  if (!isClient) &#123;</span><br><span class="line">    return [initialValue as T, noop, noop];</span><br><span class="line">  &#125;</span><br><span class="line">  if (!key) &#123;</span><br><span class="line">    throw new Error('useLocalStorage key may not be falsy');</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const deserializer = options ? (options.raw ? value =&gt; value : options.deserializer) : JSON.parse;</span><br><span class="line"></span><br><span class="line">  const [state, setState] = useState&lt;T | undefined&gt;(() =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const serializer = options ? (options.raw ? String : options.serializer) : JSON.stringify;</span><br><span class="line"></span><br><span class="line">      const localStorageValue = localStorage.getItem(key);</span><br><span class="line">      if (localStorageValue !== null) &#123;</span><br><span class="line">        return deserializer(localStorageValue);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        initialValue &amp;&amp; localStorage.setItem(key, serializer(initialValue));</span><br><span class="line">        return initialValue;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      // If user is in private mode or has storage restriction</span><br><span class="line">      // localStorage can throw. JSON.parse and JSON.stringify</span><br><span class="line">      // can throw, too.</span><br><span class="line">      return initialValue;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  const set: Dispatch&lt;SetStateAction&lt;T | undefined&gt;&gt; = useCallback(</span><br><span class="line">    valOrFunc =&gt; &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">        const newState = typeof valOrFunc === 'function' ? (valOrFunc as Function)(state) : valOrFunc;</span><br><span class="line">        if (typeof newState === 'undefined') return;</span><br><span class="line">        let value: string;</span><br><span class="line"></span><br><span class="line">        if (options)</span><br><span class="line">          if (options.raw)</span><br><span class="line">            if (typeof newState === 'string') value = newState;</span><br><span class="line">            else value = JSON.stringify(newState);</span><br><span class="line">          else if (options.serializer) value = options.serializer(newState);</span><br><span class="line">          else value = JSON.stringify(newState);</span><br><span class="line">        else value = JSON.stringify(newState);</span><br><span class="line"></span><br><span class="line">        localStorage.setItem(key, value);</span><br><span class="line">        setState(deserializer(value));</span><br><span class="line">      &#125; catch &#123;</span><br><span class="line">        // If user is in private mode or has storage restriction</span><br><span class="line">        // localStorage can throw. Also JSON.stringify can throw.</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    [key, setState]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  const remove = useCallback(() =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      localStorage.removeItem(key);</span><br><span class="line">      setState(undefined);</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      // If user is in private mode or has storage restriction</span><br><span class="line">      // localStorage can throw.</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [key, setState]);</span><br><span class="line"></span><br><span class="line">  return [state, set, remove];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useLocalStorage;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.对非浏览器环境（用window变量判断）做了处理，直接返回原值，操作函数为空函数；</li>
<li><ol start="2">
<li>serializer/deserializer处理函数用于hook state调用，不影响localStorage的读写；</li>
</ol>
</li>
<li>3.参数raw为false时，默认设置storage操作时会执行JSON.stringify(val)处理，读取storage操作时会执行JSON.parse(val)处理；</li>
<li>4.参数raw为true时，serializer默认为String，即设置storage操作时执行String(val)处理；deserializer默认为<code>value =&gt; value</code>，即读取storage操作时会直接返回；</li>
</ul>
<h4 id="useSessionStorage"><a href="#useSessionStorage" class="headerlink" title="useSessionStorage"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useSessionStorage.md" target="_blank" rel="noopener">useSessionStorage</a></h4><p>用于sessionStorage的处理。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const [value, setValue] = useSessionStorage(key, initialValue, &#123;</span><br><span class="line">  raw: false,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>key：{String}，storage标识</li>
<li>initialValue：{any}，storage值</li>
<li>options：参数，可选<ul>
<li>raw：{Boolean}，是否自定义加工处理。默认<code>false</code>，为JSON.stringify/JSON.parse。</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSessionStorage&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useSessionStorage(<span class="string">'my-key'</span>, <span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;Value: &#123;value&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setValue('bar')&#125;&gt;bar&lt;/</span>button&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setValue(<span class="string">'baz'</span>)&#125;&gt;baz&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-3"><a href="#源码及解析-3" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useSessionStorage.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isClient &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useSessionStorage = <span class="xml"><span class="tag">&lt;<span class="name">T</span>&gt;</span>(key: string, initialValue?: T, raw?: boolean): [T, (value: T) =&gt; void] =&gt; &#123;</span></span><br><span class="line"><span class="xml">  if (!isClient) &#123;</span></span><br><span class="line"><span class="xml">    return [initialValue as T, () =&gt; &#123;&#125;];</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"></span><br><span class="line">  const [state, setState] = useState&lt;T&gt;(() =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const sessionStorageValue = sessionStorage.getItem(key);</span><br><span class="line">      if (typeof sessionStorageValue !== 'string') &#123;</span><br><span class="line">        sessionStorage.setItem(key, raw ? String(initialValue) : JSON.stringify(initialValue));</span><br><span class="line">        return initialValue;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return raw ? sessionStorageValue : JSON.parse(sessionStorageValue || 'null');</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      // If user is in private mode or has storage restriction</span><br><span class="line">      // sessionStorage can throw. JSON.parse and JSON.stringify</span><br><span class="line">      // cat throw, too.</span><br><span class="line">      return initialValue;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">      const serializedState = raw ? String(state) : JSON.stringify(state);</span><br><span class="line">      sessionStorage.setItem(key, serializedState);</span><br><span class="line">    &#125; catch &#123;</span><br><span class="line">      // If user is in private mode or has storage restriction</span><br><span class="line">      // sessionStorage can throw. Also JSON.stringify can throw.</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return [state, setState];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useSessionStorage;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.对非浏览器环境（用window变量判断）做了处理，直接返回原值，操作函数为空函数；</li>
<li>2.参数raw为false时，默认设置storage操作时会执行JSON.stringify(val)处理，读取storage操作时会执行JSON.parse(val)处理；</li>
<li>3.sessionStorage的应用场景相对localStorage较小，因此无需发布订阅的控制</li>
</ul>
<h4 id="useRafLoop"><a href="#useRafLoop" class="headerlink" title="useRafLoop"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useRafLoop.md" target="_blank" rel="noopener">useRafLoop</a></h4><p>控制requestAnimationFrame循环。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [stopLoop, startLoop, isActive] = useRafLoop(callback: FrameRequestCallback, initiallyActive = true);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>callback：{Function}，RAF片段的控制回调函数</li>
<li>initiallyActive: {boolean}，是否已开始就激活循环，默认为<code>true</code>。</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useRafLoop, useUpdate &#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [ticks, setTicks] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [lastCall, setLastCall] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> update = useUpdate();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [loopStop, loopStart, isActive] = useRafLoop(<span class="function">(<span class="params">time</span>) =&gt;</span> &#123;</span><br><span class="line">    setTicks(<span class="function"><span class="params">ticks</span> =&gt;</span> ticks + <span class="number">1</span>);</span><br><span class="line">    setLastCall(time);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;RAF triggered: &#123;ticks&#125; (times)&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;Last high res timestamp: &#123;lastCall&#125;&lt;/</span>div&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; &#123;</span><br><span class="line">        isActive() ? loopStop() : loopStart();</span><br><span class="line">        update();</span><br><span class="line">      &#125;&#125;&gt;&#123;isActive() ? <span class="string">'STOP'</span> : <span class="string">'START'</span>&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-4"><a href="#源码及解析-4" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useRafLoop.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useCallback, useEffect, useMemo, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type RafLoopReturns = [<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>, () =&gt; <span class="keyword">void</span>, () =&gt; boolean];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useRafLoop</span>(<span class="params">callback: FrameRequestCallback, initiallyActive = true</span>): <span class="title">RafLoopReturns</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> raf = useRef&lt;number | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> rafActivity = useRef&lt;boolean&gt;(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> rafCallback = useRef(callback);</span><br><span class="line">  rafCallback.current = callback;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> step = useCallback(<span class="function">(<span class="params">time: number</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (rafActivity.current) &#123;</span><br><span class="line">      rafCallback.current(time);</span><br><span class="line">      raf.current = requestAnimationFrame(step);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> ([</span><br><span class="line">    () =&gt; &#123; <span class="comment">// stop</span></span><br><span class="line">      <span class="keyword">if</span> (rafActivity.current) &#123;</span><br><span class="line">        rafActivity.current = <span class="literal">false</span>;</span><br><span class="line">        raf.current &amp;&amp; cancelAnimationFrame(raf.current);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    () =&gt; &#123; <span class="comment">// start</span></span><br><span class="line">      <span class="keyword">if</span> (!rafActivity.current) &#123;</span><br><span class="line">        rafActivity.current = <span class="literal">true</span>;</span><br><span class="line">        raf.current = requestAnimationFrame(step);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    (): <span class="function"><span class="params">boolean</span> =&gt;</span> rafActivity.current  <span class="comment">// isActive</span></span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  ] <span class="keyword">as</span> RafLoopReturns), []);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (initiallyActive) &#123;</span><br><span class="line">      result[<span class="number">1</span>]();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.用ref来缓存raf控制器；</li>
<li>2.用useMemo()来缓存控制方法；</li>
<li>3.组件销毁时会取消raf；</li>
</ul>
<h4 id="useError"><a href="#useError" class="headerlink" title="useError"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useError.md" target="_blank" rel="noopener">useError</a></h4><p>抛出异常控制。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const dispatchError = useError();</span><br></pre></td></tr></table></figure></p>
<p>参数：无</p>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useError &#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatchError = useError();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clickHandler = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatchError(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Some error!'</span>));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;clickHandler&#125;</span>&gt;</span>Click me to throw<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// In parent app</span></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;ErrorBoundary&gt;</span><br><span class="line">    &lt;Demo /&gt;</span><br><span class="line">  &lt;<span class="regexp">/ErrorBoundary&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-5"><a href="#源码及解析-5" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useError.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useState, useEffect, useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useError = <span class="function"><span class="params">()</span>: (<span class="params">(err: <span class="built_in">Error</span></span>) =&gt;</span> <span class="keyword">void</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [error, setError] = useState&lt;<span class="built_in">Error</span> | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [error]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatchError = useCallback(<span class="function">(<span class="params">err: <span class="built_in">Error</span></span>) =&gt;</span> &#123;</span><br><span class="line">    setError(err);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> dispatchError;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useError;</span><br></pre></td></tr></table></figure>
<p>throw异常。</p>
<h4 id="useFavicon"><a href="#useFavicon" class="headerlink" title="useFavicon"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useFavicon.md" target="_blank" rel="noopener">useFavicon</a></h4><p>设置浏览器标题图标。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useFavicon(iconUrl)</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>iconUrl：{String}，图标url地址</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useFavicon&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  useFavicon(<span class="string">'https://cdn.sstatic.net/Sites/stackoverflow/img/favicon.ico'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-6"><a href="#源码及解析-6" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useFavicon.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useFavicon = <span class="function">(<span class="params">href: string</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> link: HTMLLinkElement = <span class="built_in">document</span>.querySelector(<span class="string">"link[rel*='icon']"</span>) || <span class="built_in">document</span>.createElement(<span class="string">'link'</span>);</span><br><span class="line">    link.type = <span class="string">'image/x-icon'</span>;</span><br><span class="line">    link.rel = <span class="string">'shortcut icon'</span>;</span><br><span class="line">    link.href = href;</span><br><span class="line">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(link);</span><br><span class="line">  &#125;, [href]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useFavicon;</span><br></pre></td></tr></table></figure>
<p>简单来说，就是设置属性是icon的link标签的引用地址。</p>
<h4 id="usePermission"><a href="#usePermission" class="headerlink" title="*usePermission"></a>*<a href="https://github.com/streamich/react-use/blob/master/docs/usePermission.md" target="_blank" rel="noopener">usePermission</a></h4><p>浏览器API兼容状态的信息获取（基于<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/permissions#Browser_compatibility" target="_blank" rel="noopener">navigator.permissions</a>）</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const state = usePermission(&#123; name: &apos;microphone&apos; &#125;);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>options：{Object}，参数<ul>
<li>name：{String}，API字段</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;usePermission&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> state = usePermission(&#123; <span class="attr">name</span>: <span class="string">'microphone'</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;pre&gt;</span><br><span class="line">      &#123;<span class="built_in">JSON</span>.stringify(state, <span class="literal">null</span>, <span class="number">2</span>)&#125;</span><br><span class="line">    &lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-7"><a href="#源码及解析-7" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/usePermission.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; off, on &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;</span><br><span class="line"></span><br><span class="line">type PermissionDesc =</span><br><span class="line">  | PermissionDescriptor</span><br><span class="line">  | DevicePermissionDescriptor</span><br><span class="line">  | MidiPermissionDescriptor</span><br><span class="line">  | PushPermissionDescriptor;</span><br><span class="line"></span><br><span class="line">type State = PermissionState | <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> noop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> usePermission = (permissionDesc: PermissionDesc): <span class="function"><span class="params">State</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> mounted = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">let</span> permissionStatus: PermissionStatus | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState&lt;State&gt;(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mounted &amp;&amp; permissionStatus) &#123;</span><br><span class="line">      setState(permissionStatus.state);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> changeState = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    onChange();</span><br><span class="line">    on(permissionStatus, <span class="string">'change'</span>, onChange);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    navigator.permissions</span><br><span class="line">      .query(permissionDesc)</span><br><span class="line">      .then(<span class="function"><span class="params">status</span> =&gt;</span> &#123;</span><br><span class="line">        permissionStatus = status;</span><br><span class="line">        changeState();</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(noop);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      mounted = <span class="literal">false</span>;</span><br><span class="line">      permissionStatus &amp;&amp; off(permissionStatus, <span class="string">'change'</span>, onChange);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> usePermission;</span><br></pre></td></tr></table></figure>
<p>核心还是navigator.permissions。不过由于兼容问题，基本不会用。</p>
<p><img src="/image/react/p-permissions_c.jpg" alt="p-permissions_c.jpg"></p>
<h4 id="useBeforeUnload-md"><a href="#useBeforeUnload-md" class="headerlink" title="useBeforeUnload.md"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useBeforeUnload.md" target="_blank" rel="noopener">useBeforeUnload.md</a></h4><p>页面将退出/即将重新加载时触发。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useBeforeUnload(enabled, message);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>enabled：{Boolean}，是否启用</li>
<li>message：{String}，退出/将重启加载时的提示文案</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 布尔值使用</span></span><br><span class="line"><span class="comment">// *useToggle() 也是react-use提供的一个钩子函数，用于切换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;useBeforeUnload&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [dirty, toggleDirty] = useToggle(<span class="literal">false</span>);</span><br><span class="line">  useBeforeUnload(dirty, <span class="string">'You have unsaved changes, are you sure?'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;dirty &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Try to reload or close tab<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; toggleDirty()&#125;&gt;&#123;dirty ? <span class="string">'Disable'</span> : <span class="string">'Enable'</span>&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法是用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;useBeforeUnload&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [dirty, toggleDirty] = useToggle(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> dirtyFn = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dirty;</span><br><span class="line">  &#125;, [dirty]);</span><br><span class="line">  useBeforeUnload(dirtyFn, <span class="string">'You have unsaved changes, are you sure?'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;dirty &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Try to reload or close tab<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; toggleDirty()&#125;&gt;&#123;dirty ? <span class="string">'Disable'</span> : <span class="string">'Enable'</span>&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="源码及解析-8"><a href="#源码及解析-8" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useBeforeUnload.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useCallback, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useBeforeUnload = <span class="function">(<span class="params">enabled: boolean | ((</span>) =&gt;</span> boolean) = <span class="literal">true</span>, message?: string) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> handler = useCallback(</span><br><span class="line">    (event: BeforeUnloadEvent) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> finalEnabled = <span class="keyword">typeof</span> enabled === <span class="string">'function'</span> ? enabled() : <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!finalEnabled) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      event.preventDefault();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (message) &#123;</span><br><span class="line">        event.returnValue = message;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> message;</span><br><span class="line">    &#125;,</span><br><span class="line">    [enabled, message]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!enabled) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'beforeunload'</span>, handler);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'beforeunload'</span>, handler);</span><br><span class="line">  &#125;, [enabled, handler]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useBeforeUnload;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.核心基于beforeunload的事件和解除；</li>
<li>2.enabled默认为<code>true</code>，当传入函数时则获取函数执行结果，闭包的作用。；</li>
<li>3.考虑了IE的event.returnValue用于事件捕获。</li>
</ul>
<p>beforeunload事件的兼容情况：<br><img src="/image/react/p-beforeunload_c.jpg" alt="p-beforeunload_c.jpg"></p>
<h4 id="useLockBodyScroll"><a href="#useLockBodyScroll" class="headerlink" title="useLockBodyScroll"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useLockBodyScroll.md" target="_blank" rel="noopener">useLockBodyScroll</a></h4><p>控制区域滚动条是否可以滚动。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLockBodyScroll(locked = true, elementRef);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>locked：{Boolean}，是否锁定滚动，默认为<code>true</code>；</li>
<li>elementRef：{DOMElement}，滚动区域元素</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// *useToggle() 也是react-use提供的一个钩子函数，用于切换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;useLockBodyScroll, useToggle&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [locked, toggleLocked] = useToggle(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  useLockBodyScroll(locked);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; toggleLocked()&#125;&gt;</span><br><span class="line">        &#123;locked ? <span class="string">'Unlock'</span> : <span class="string">'Lock'</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-9"><a href="#源码及解析-9" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useLockBodyScroll.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; RefObject, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getClosestBody</span>(<span class="params">el: Element | HTMLElement | HTMLIFrameElement | null</span>): <span class="title">HTMLElement</span> | <span class="title">null</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!el) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.tagName === <span class="string">'BODY'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> el <span class="keyword">as</span> HTMLElement;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.tagName === <span class="string">'IFRAME'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">document</span> = (el <span class="keyword">as</span> HTMLIFrameElement).contentDocument;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span> ? <span class="built_in">document</span>.body : <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!(el <span class="keyword">as</span> HTMLElement).offsetParent) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> getClosestBody((el <span class="keyword">as</span> HTMLElement).offsetParent!);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">preventDefault</span>(<span class="params">rawEvent: TouchEvent</span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = rawEvent || <span class="built_in">window</span>.event;</span><br><span class="line">  <span class="comment">// Do not prevent if the event has more than one touch (usually meaning this is a multi touch gesture like pinch to zoom).</span></span><br><span class="line">  <span class="keyword">if</span> (e.touches.length &gt; <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (e.preventDefault) e.preventDefault();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface BodyInfoItem &#123;</span><br><span class="line">  counter: number;</span><br><span class="line">  initialOverflow: CSSStyleDeclaration[<span class="string">'overflow'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isIosDevice =</span><br><span class="line">  <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> &amp;&amp;</span><br><span class="line">  <span class="built_in">window</span>.navigator &amp;&amp;</span><br><span class="line">  <span class="built_in">window</span>.navigator.platform &amp;&amp;</span><br><span class="line">  /iP(ad|hone|od)/.test(<span class="built_in">window</span>.navigator.platform);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bodies: <span class="built_in">Map</span>&lt;HTMLElement, BodyInfoItem&gt; = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> doc: Document | <span class="literal">undefined</span> = <span class="keyword">typeof</span> <span class="built_in">document</span> === <span class="string">'object'</span> ? <span class="built_in">document</span> : <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> documentListenerAdded = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> !doc</span><br><span class="line">  ? <span class="function"><span class="keyword">function</span> <span class="title">useLockBodyMock</span>(<span class="params">_locked: boolean = true, _elementRef?: RefObject&lt;HTMLElement&gt;</span>) </span>&#123;&#125;</span><br><span class="line">  : <span class="function"><span class="keyword">function</span> <span class="title">useLockBody</span>(<span class="params">locked: boolean = true, elementRef?: RefObject&lt;HTMLElement&gt;</span>) </span>&#123;</span><br><span class="line">      elementRef = elementRef || useRef(doc!.body);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> lock = <span class="function"><span class="params">body</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> bodyInfo = bodies.get(body);</span><br><span class="line">        <span class="keyword">if</span> (!bodyInfo) &#123;</span><br><span class="line">          bodies.set(body, &#123; <span class="attr">counter</span>: <span class="number">1</span>, <span class="attr">initialOverflow</span>: body.style.overflow &#125;);</span><br><span class="line">          <span class="keyword">if</span> (isIosDevice) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!documentListenerAdded) &#123;</span><br><span class="line">              <span class="built_in">document</span>.addEventListener(<span class="string">'touchmove'</span>, preventDefault, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">              documentListenerAdded = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            body.style.overflow = <span class="string">'hidden'</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          bodies.set(body, &#123; <span class="attr">counter</span>: bodyInfo.counter + <span class="number">1</span>, <span class="attr">initialOverflow</span>: bodyInfo.initialOverflow &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> unlock = <span class="function"><span class="params">body</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> bodyInfo = bodies.get(body);</span><br><span class="line">        <span class="keyword">if</span> (bodyInfo) &#123;</span><br><span class="line">          <span class="keyword">if</span> (bodyInfo.counter === <span class="number">1</span>) &#123;</span><br><span class="line">            bodies.delete(body);</span><br><span class="line">            <span class="keyword">if</span> (isIosDevice) &#123;</span><br><span class="line">              body.ontouchmove = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (documentListenerAdded) &#123;</span><br><span class="line">                <span class="built_in">document</span>.removeEventListener(<span class="string">'touchmove'</span>, preventDefault);</span><br><span class="line">                documentListenerAdded = <span class="literal">false</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              body.style.overflow = bodyInfo.initialOverflow;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bodies.set(body, &#123; <span class="attr">counter</span>: bodyInfo.counter - <span class="number">1</span>, <span class="attr">initialOverflow</span>: bodyInfo.initialOverflow &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> body = getClosestBody(elementRef!.current);</span><br><span class="line">        <span class="keyword">if</span> (!body) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (locked) &#123;</span><br><span class="line">          lock(body);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          unlock(body);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, [locked, elementRef.current]);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// clean up, on un-mount</span></span><br><span class="line">      useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> body = getClosestBody(elementRef!.current);</span><br><span class="line">        <span class="keyword">if</span> (!body) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          unlock(body);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;, []);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.<code>&lt;body&gt;</code>和<code>&lt;iframe&gt;</code>元素会默认本身为滚动元素，其他元素则会向上层递归寻找滚动元素，这也是为何官方会推荐使用<code>&lt;body&gt;</code>或<code>&lt;iframe&gt;</code>作为控制元素的原因，因为它们没有parent；</li>
<li>2.滚动的锁定控制会根据平台来区分处理，iOS是通过touchmove事件来控制，而其他平台是通过设置元素的overflow样式属性控制；</li>
</ul>
<h4 id="useCopyToClipboard"><a href="#useCopyToClipboard" class="headerlink" title="useCopyToClipboard"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useCopyToClipboard.md" target="_blank" rel="noopener">useCopyToClipboard</a></h4><p>用户剪切板的拷贝控制。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [&#123;value, error, noUserInteraction&#125;, copyToClipboard] = useCopyToClipboard();</span><br></pre></td></tr></table></figure></p>
<p>参数：无</p>
<p>返回：</p>
<ul>
<li>dataObj：{Object}，返回字段<ul>
<li>value：{String}，已经被拷贝的值；</li>
<li>error：{String}，是否被捕获异常；</li>
<li>noUserInteraction：{Boolean}，用户交互拷贝的值是否暴露给<code>copy-to-clipboard</code>这个库</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [text, setText] = React.useState(<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">const</span> [state, copyToClipboard] = useCopyToClipboard();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input value=&#123;text&#125; onChange=&#123;e =&gt; setText(e.target.value)&#125; /&gt;</span><br><span class="line">      &lt;button type=<span class="string">"button"</span> onClick=&#123;() =&gt; copyToClipboard(text)&#125;&gt;copy text&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &#123;state.error</span></span><br><span class="line"><span class="regexp">        ? &lt;p&gt;Unable to copy value: &#123;state.error.message&#125;&lt;/</span>p&gt;</span><br><span class="line">        : state.value &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Copied &#123;state.value&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-10"><a href="#源码及解析-10" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useCopyToClipboard.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> writeText <span class="keyword">from</span> <span class="string">'copy-to-clipboard'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useMountedState <span class="keyword">from</span> <span class="string">'./useMountedState'</span>;</span><br><span class="line"><span class="keyword">import</span> useSetState <span class="keyword">from</span> <span class="string">'./useSetState'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface CopyToClipboardState &#123;</span><br><span class="line">  value?: string;</span><br><span class="line">  noUserInteraction: boolean;</span><br><span class="line">  error?: <span class="built_in">Error</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCopyToClipboard = <span class="function"><span class="params">()</span>: [<span class="params">CopyToClipboardState</span>, (<span class="params">value: string</span>) =&gt;</span> <span class="keyword">void</span>] =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> isMounted = useMountedState();</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useSetState&lt;CopyToClipboardState&gt;(&#123;</span><br><span class="line">    value: <span class="literal">undefined</span>,</span><br><span class="line">    error: <span class="literal">undefined</span>,</span><br><span class="line">    noUserInteraction: <span class="literal">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> copyToClipboard = useCallback(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isMounted()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> noUserInteraction;</span><br><span class="line">    <span class="keyword">let</span> normalizedValue;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// only strings and numbers casted to strings can be copied to clipboard</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> value !== <span class="string">'string'</span> &amp;&amp; <span class="keyword">typeof</span> value !== <span class="string">'number'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Cannot copy typeof <span class="subst">$&#123;<span class="keyword">typeof</span> value&#125;</span> to clipboard, must be a string`</span>);</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) <span class="built_in">console</span>.error(error);</span><br><span class="line">        setState(&#123;</span><br><span class="line">          value,</span><br><span class="line">          error,</span><br><span class="line">          noUserInteraction: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// empty strings are also considered invalid</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (value === <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> error = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Cannot copy empty string to clipboard.`</span>);</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV === <span class="string">'development'</span>) <span class="built_in">console</span>.error(error);</span><br><span class="line">        setState(&#123;</span><br><span class="line">          value,</span><br><span class="line">          error,</span><br><span class="line">          noUserInteraction: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      normalizedValue = value.toString();</span><br><span class="line">      noUserInteraction = writeText(normalizedValue);</span><br><span class="line">      setState(&#123;</span><br><span class="line">        value: normalizedValue,</span><br><span class="line">        error: <span class="literal">undefined</span>,</span><br><span class="line">        noUserInteraction,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      setState(&#123;</span><br><span class="line">        value: normalizedValue,</span><br><span class="line">        error,</span><br><span class="line">        noUserInteraction,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, copyToClipboard];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCopyToClipboard;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.整个拷贝的处理依赖于<a href="https://www.npmjs.com/package/copy-to-clipboard" target="_blank" rel="noopener">copy-to-clipboard</a>，其核心是<code>document.execCommand()</code>；</li>
</ul>
<p><img src="/image/react/p-execCommand_c.jpg" alt="p-execCommand_c.jpg"></p>
<ul>
<li>2.捕获异常通过<code>try...catch...</code></li>
<li>3.<code>useMountedState()</code>也是react-use提供的一个钩子函数，用于获取组件mount状态信息；</li>
</ul>
<h4 id="useDebounce"><a href="#useDebounce" class="headerlink" title="useDebounce"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useDebounce.md" target="_blank" rel="noopener">useDebounce</a></h4><p>防抖。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const [</span><br><span class="line">    isReady: () =&gt; boolean | null,</span><br><span class="line">    cancel: () =&gt; void,</span><br><span class="line">] = useDebounce(fn: Function, ms: number, deps: DependencyList = []);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，回调函数；</li>
<li>ms：{Number}，延迟时间，毫秒；</li>
<li>deps：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>返回：</p>
<ul>
<li>isReady：<code>()=&gt; boolean|null</code>。当前防抖函数的执行状态。<ul>
<li><code>false</code>：pending</li>
<li><code>true</code>：called</li>
<li><code>null</code>：cancelled</li>
</ul>
</li>
<li>cancel: <code>()=&gt;void</code>。取消执行</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = React.useState(<span class="string">'Typing stopped'</span>);</span><br><span class="line">  <span class="keyword">const</span> [val, setVal] = React.useState(<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">const</span> [debouncedValue, setDebouncedValue] = React.useState(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [, cancel] = useDebounce(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      setState(<span class="string">'Typing stopped'</span>);</span><br><span class="line">      setDebouncedValue(val);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">2000</span>,</span><br><span class="line">    [val]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input</span><br><span class="line">        type=<span class="string">"text"</span></span><br><span class="line">        value=&#123;val&#125;</span><br><span class="line">        placeholder=<span class="string">"Debounced input"</span></span><br><span class="line">        onChange=&#123;(&#123; currentTarget &#125;) =&gt; &#123;</span><br><span class="line">          setState(<span class="string">'Waiting for typing to stop...'</span>);</span><br><span class="line">          setVal(currentTarget.value);</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;div&gt;&#123;state&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        Debounced value: &#123;debouncedValue&#125;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;cancel&#125;&gt;Cancel debounce&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-11"><a href="#源码及解析-11" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useDebounce.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useTimeoutFn <span class="keyword">from</span> <span class="string">'./useTimeoutFn'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type UseDebounceReturn = [<span class="function"><span class="params">()</span> =&gt;</span> boolean | <span class="literal">null</span>, () =&gt; <span class="keyword">void</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useDebounce</span>(<span class="params">fn: Function, ms: number = <span class="number">0</span>, deps: DependencyList = []</span>): <span class="title">UseDebounceReturn</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [isReady, cancel, reset] = useTimeoutFn(fn, ms);</span><br><span class="line"></span><br><span class="line">  useEffect(reset, deps);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [isReady, cancel];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useTimeoutFn.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useCallback, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type UseTimeoutFnReturn = [<span class="function"><span class="params">()</span> =&gt;</span> boolean | <span class="literal">null</span>, () =&gt; <span class="keyword">void</span>, () =&gt; <span class="keyword">void</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimeoutFn</span>(<span class="params">fn: Function, ms: number = <span class="number">0</span></span>): <span class="title">UseTimeoutFnReturn</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ready = useRef&lt;boolean | <span class="literal">null</span>&gt;(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> timeout = useRef&lt;ReturnType&lt;<span class="keyword">typeof</span> setTimeout&gt;&gt;();</span><br><span class="line">  <span class="keyword">const</span> callback = useRef(fn);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isReady = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> ready.current, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">set</span> = useCallback(() =&gt; &#123;</span><br><span class="line">    ready.current = <span class="literal">false</span>;</span><br><span class="line">    timeout.current &amp;&amp; clearTimeout(timeout.current);</span><br><span class="line"></span><br><span class="line">    timeout.current = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      ready.current = <span class="literal">true</span>;</span><br><span class="line">      callback.current();</span><br><span class="line">    &#125;, ms);</span><br><span class="line">  &#125;, [ms]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clear = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ready.current = <span class="literal">null</span>;</span><br><span class="line">    timeout.current &amp;&amp; clearTimeout(timeout.current);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update ref when function changes</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    callback.current = fn;</span><br><span class="line">  &#125;, [fn]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set on mount, clear on unmount</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">set</span>();</span><br><span class="line"></span><br><span class="line">    return clear;</span><br><span class="line">  &#125;, [ms]);</span><br><span class="line"></span><br><span class="line">  return [isReady, clear, <span class="keyword">set</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.定时器单独封装成了一个工具hook：useTimeoutFn；</li>
<li>2.useTimeoutFn中用useRef来缓存定时器返回的定时器id，避免hook的作用域副作用；</li>
</ul>
<h4 id="useThrottle"><a href="#useThrottle" class="headerlink" title="useThrottle"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useThrottle.md" target="_blank" rel="noopener">useThrottle</a></h4><p>节流。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useThrottle(value, ms?: number);</span><br><span class="line">useThrottleFn(fn, ms, args);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>value：{any}，节流的内容</li>
<li>ms：{Number}，节流延迟时间，单位为毫秒</li>
<li>args：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useThrottle, useThrottleFn &#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">&#123;value&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> throttledValue = useThrottle(value);</span><br><span class="line">  <span class="comment">// const throttledValue = useThrottleFn(value =&gt; value, 200, [value]);</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;div&gt;Value: &#123;value&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;Throttled value: &#123;throttledValue&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-12"><a href="#源码及解析-12" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useThrottle.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useUnmount <span class="keyword">from</span> <span class="string">'./useUnmount'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useThrottle = <span class="xml"><span class="tag">&lt;<span class="name">T</span>&gt;</span>(value: T, ms: number = 200) =&gt; &#123;</span></span><br><span class="line">  const [state, setState] = useState&lt;T&gt;(value);</span><br><span class="line">  const timeout = useRef&lt;ReturnType&lt;typeof setTimeout&gt;&gt;();</span><br><span class="line">  const nextValue = useRef(null) as any;</span><br><span class="line">  const hasNextValue = useRef(0) as any;</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (!timeout.current) &#123;</span><br><span class="line">      setState(value);</span><br><span class="line">      const timeoutCallback = () =&gt; &#123;</span><br><span class="line">        if (hasNextValue.current) &#123;</span><br><span class="line">          hasNextValue.current = false;</span><br><span class="line">          setState(nextValue.current);</span><br><span class="line">          timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          timeout.current = undefined;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      nextValue.current = value;</span><br><span class="line">      hasNextValue.current = true;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  useUnmount(() =&gt; &#123;</span><br><span class="line">    timeout.current &amp;&amp; clearTimeout(timeout.current);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useThrottle;</span><br></pre></td></tr></table></figure>
<ul>
<li>useUnmount主要实现了组件即将销毁时的回调，在useThrottleFn中主要作用是触发组件销毁时的定时器取消；</li>
<li>useThrottle较为简单，用useEffect来控制节流触发，以value参数作为控制变量。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useThrottleFn.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useUnmount <span class="keyword">from</span> <span class="string">'./useUnmount'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useThrottleFn = <span class="xml"><span class="tag">&lt;<span class="name">T,</span> <span class="attr">U</span> <span class="attr">extends</span> <span class="attr">any</span>[]&gt;</span>(fn: (...args: U) =&gt; T, ms: number = 200, args: U) =&gt; &#123;</span></span><br><span class="line">  const [state, setState] = useState&lt;T | null&gt;(null);</span><br><span class="line">  const timeout = useRef&lt;ReturnType&lt;typeof setTimeout&gt;&gt;();</span><br><span class="line">  const nextArgs = useRef&lt;U&gt;();</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (!timeout.current) &#123;</span><br><span class="line">      setState(fn(...args));</span><br><span class="line">      const timeoutCallback = () =&gt; &#123;</span><br><span class="line">        if (nextArgs.current) &#123;</span><br><span class="line">          setState(fn(...nextArgs.current));</span><br><span class="line">          nextArgs.current = undefined;</span><br><span class="line">          timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          timeout.current = undefined;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      timeout.current = setTimeout(timeoutCallback, ms);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      nextArgs.current = args;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, args);</span><br><span class="line"></span><br><span class="line">  useUnmount(() =&gt; &#123;</span><br><span class="line">    timeout.current &amp;&amp; clearTimeout(timeout.current);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return state;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useThrottleFn;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useUnmount.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useEffectOnce <span class="keyword">from</span> <span class="string">'./useEffectOnce'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useUnmount = <span class="function">(<span class="params">fn: (</span>) =&gt;</span> any): <span class="function"><span class="params">void</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fnRef = useRef(fn);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update the ref each render so if it change the newest callback will be invoked</span></span><br><span class="line">  fnRef.current = fn;</span><br><span class="line"></span><br><span class="line">  useEffectOnce(<span class="function"><span class="params">()</span> =&gt;</span> <span class="function"><span class="params">()</span> =&gt;</span> fnRef.current());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUnmount;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useEffectOnce.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; EffectCallback, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useEffectOnce = <span class="function">(<span class="params">effect: EffectCallback</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(effect, []);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEffectOnce;</span><br></pre></td></tr></table></figure>
<ul>
<li>useThrottleFn与useThrottle类似，主要控制了函数的触发。</li>
</ul>
<h4 id="useAsyncFn"><a href="#useAsyncFn" class="headerlink" title="useAsyncFn"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useAsyncFn.md" target="_blank" rel="noopener">useAsyncFn</a></h4><p>异步方法钩子。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const [state, fetch] = useAsyncFn&lt;Result, Args&gt;(fn, deps?: any[], initialState?: AsyncState&lt;Result&gt;);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，异步函数</li>
<li>args：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
<li>initialState：{any}，初始值</li>
</ul>
<p>返回：</p>
<ul>
<li>state：{Object}<ul>
<li>loading：{Boolean}，是否处于pending</li>
<li>error：{Error}，是否抛出了异常</li>
<li>value：{String}，返回值</li>
</ul>
</li>
<li>fetch：开始执行方法</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useAsyncFn&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">&#123;url&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, fetch] = useAsyncFn(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> response.text();</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;, [url]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;state.loading</span><br><span class="line">        ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        : state.error</span><br><span class="line">          ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error: &#123;state.error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">          : <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Value: &#123;state.value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; fetch()&#125;&gt;Start loading&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-13"><a href="#源码及解析-13" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useAsyncFn.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, useCallback, useState, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useMountedState <span class="keyword">from</span> <span class="string">'./useMountedState'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FnReturningPromise, PromiseType &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type AsyncState&lt;T&gt; =</span><br><span class="line">  | &#123;</span><br><span class="line">      loading: boolean;</span><br><span class="line">      error?: <span class="literal">undefined</span>;</span><br><span class="line">      value?: <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  | &#123;</span><br><span class="line">      loading: <span class="literal">true</span>;</span><br><span class="line">      error?: <span class="built_in">Error</span> | <span class="literal">undefined</span>;</span><br><span class="line">      value?: T;</span><br><span class="line">    &#125;</span><br><span class="line">  | &#123;</span><br><span class="line">      loading: <span class="literal">false</span>;</span><br><span class="line">      error: <span class="built_in">Error</span>;</span><br><span class="line">      value?: <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  | &#123;</span><br><span class="line">      loading: <span class="literal">false</span>;</span><br><span class="line">      error?: <span class="literal">undefined</span>;</span><br><span class="line">      value: T;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">type StateFromFnReturningPromise&lt;T extends FnReturningPromise&gt; = AsyncState&lt;PromiseType&lt;ReturnType&lt;T&gt;&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type AsyncFnReturn&lt;T extends FnReturningPromise = FnReturningPromise&gt; = [StateFromFnReturningPromise&lt;T&gt;, T];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useAsyncFn</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">FnReturningPromise</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  fn: T,</span></span></span><br><span class="line"><span class="function"><span class="params">  deps: DependencyList = [],</span></span></span><br><span class="line"><span class="function"><span class="params">  initialState: StateFromFnReturningPromise&lt;T&gt; = &#123; loading: false &#125;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">AsyncFnReturn</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> lastCallId = useRef(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> isMounted = useMountedState();</span><br><span class="line">  <span class="keyword">const</span> [state, <span class="keyword">set</span>] = useState&lt;StateFromFnReturningPromise&lt;T&gt;&gt;(initialState);</span><br><span class="line"></span><br><span class="line">  const callback = useCallback((...args: Parameters&lt;T&gt;): ReturnType&lt;T&gt; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> callId = ++lastCallId.current;</span><br><span class="line">    <span class="keyword">set</span>(prevState =&gt; (&#123; ...prevState, <span class="attr">loading</span>: <span class="literal">true</span> &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fn(...args).then(</span><br><span class="line">      value =&gt; &#123;</span><br><span class="line">        isMounted() &amp;&amp; callId === lastCallId.current &amp;&amp; <span class="keyword">set</span>(&#123; value, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">      &#125;,</span><br><span class="line">      error =&gt; &#123;</span><br><span class="line">        isMounted() &amp;&amp; callId === lastCallId.current &amp;&amp; <span class="keyword">set</span>(&#123; error, <span class="attr">loading</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">      &#125;</span><br><span class="line">    ) <span class="keyword">as</span> ReturnType&lt;T&gt;;</span><br><span class="line">  &#125;, deps);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, (callback <span class="keyword">as</span> unknown) <span class="keyword">as</span> T];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>从util库中引用的FnReturningPromise, PromiseType只是对类型的定义声明；</li>
</ul>
<h4 id="useAsync"><a href="#useAsync" class="headerlink" title="useAsync"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useAsync.md" target="_blank" rel="noopener">useAsync</a></h4><p>异步钩子。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const state = useAsync(fn, args?: any[]);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，异步函数</li>
<li>args：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>返回：</p>
<ul>
<li>state：{Object}<ul>
<li>loading：{Boolean}，是否处于pending</li>
<li>error：{Error}，是否抛出了异常</li>
<li>value：{String}，返回值</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useAsync&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">&#123;url&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> state = useAsync(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> response.text();</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;, [url]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;state.loading</span><br><span class="line">        ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        : state.error</span><br><span class="line">          ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error: &#123;state.error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">          : <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Value: &#123;state.value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-14"><a href="#源码及解析-14" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useAsync.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useAsyncFn <span class="keyword">from</span> <span class="string">'./useAsyncFn'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; FnReturningPromise &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; AsyncState, AsyncFnReturn &#125; <span class="keyword">from</span> <span class="string">'./useAsyncFn'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useAsync</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">FnReturningPromise</span>&gt;(<span class="params">fn: T, deps: DependencyList = []</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, callback] = useAsyncFn(fn, deps, &#123;</span><br><span class="line">    loading: <span class="literal">true</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    callback();</span><br><span class="line">  &#125;, [callback]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就是在useAsyncFn之上做了一层封装。</p>
<h4 id="useAsyncRetry"><a href="#useAsyncRetry" class="headerlink" title="useAsyncRetry"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useAsyncRetry.md" target="_blank" rel="noopener">useAsyncRetry</a></h4><p>带取消功能的异步钩子。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const state = useAsyncRetry(fn, args?: any[]);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，异步函数</li>
<li>args：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>返回：</p>
<ul>
<li>state：{Object}<ul>
<li>loading：{Boolean}，是否处于pending</li>
<li>error：{Error}，是否抛出了异常</li>
<li>value：{String}，返回值</li>
<li>retry：{Function}，取消方法</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useAsyncRetry&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">&#123;url&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> state = useAsyncRetry(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(url);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> response.text();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;, [url]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;state.loading</span><br><span class="line">        ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        : state.error</span><br><span class="line">          ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error: &#123;state.error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">          : <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Value: &#123;state.value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">      &#123;!loading &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> state.retry()&#125;&gt;Start loading<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-15"><a href="#源码及解析-15" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useAsyncRetry.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, useCallback, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useAsync, &#123; AsyncState &#125; <span class="keyword">from</span> <span class="string">'./useAsync'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type AsyncStateRetry&lt;T&gt; = AsyncState&lt;T&gt; &amp; &#123;</span><br><span class="line">  retry(): <span class="keyword">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useAsyncRetry = &lt;T&gt;(fn: () =&gt; Promise&lt;T&gt;, deps: DependencyList = []) =&gt; &#123;</span><br><span class="line">  const [attempt, setAttempt] = useState&lt;number&gt;(0);</span><br><span class="line">  const state = useAsync(fn, [...deps, attempt]);</span><br><span class="line"></span><br><span class="line">  const stateLoading = state.loading;</span><br><span class="line">  const retry = useCallback(() =&gt; &#123;</span><br><span class="line">    if (stateLoading) &#123;</span><br><span class="line">      if (process.env.NODE_ENV === 'development') &#123;</span><br><span class="line">        console.log('You are calling useAsyncRetry hook retry() method while loading in progress, this is a no-op.');</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setAttempt(currentAttempt =&gt; currentAttempt + 1);</span><br><span class="line">  &#125;, [...deps, stateLoading]);</span><br><span class="line"></span><br><span class="line">  return &#123; ...state, retry &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useAsyncRetry;</span><br></pre></td></tr></table></figure>
<p>基于useAsync的封装，通过封装回调方法来控制退出方法。</p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><h3 id="useEffectOnce"><a href="#useEffectOnce" class="headerlink" title="useEffectOnce"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useEffectOnce.md" target="_blank" rel="noopener">useEffectOnce</a></h3><p>只执行一次的effect钩子。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useEffectOnce(effect: EffectCallback);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>effect：{Function}，副作用回调</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useEffectOnce&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  useEffectOnce(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Running effect once on mount'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Running clean-up of effect on unmount'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-16"><a href="#源码及解析-16" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useEffectOnce.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; EffectCallback, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> useEffectOnce = <span class="function">(<span class="params">effect: EffectCallback</span>) =&gt;</span> &#123;</span><br><span class="line">	useEffect(effect, []);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useEffectOnce;</span><br></pre></td></tr></table></figure>
<p>不需要解释。。。</p>
<h4 id="useEvent"><a href="#useEvent" class="headerlink" title="useEvent"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useEvent.md" target="_blank" rel="noopener">useEvent</a></h4><p>事件处理。</p>
<p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useEvent(event, handler)</span><br><span class="line">useEvent(event, handler, target, options)</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li>event：{String}，事件名称；</li>
<li>handler：{function}，事件函数；</li>
<li>target：{DOMElement|Window}，事件节点；</li>
<li>options：{Object}，参数。一个指定有关 listener 属性的可选参数对象。可用的选项如下：<ul>
<li>capture：{Boolean}，表示 listener 会在该类型的事件捕获阶段传播到该 EventTarget 时触发。</li>
<li>once：{Boolean}，表示 listener 在添加之后最多只调用一次。如果是 true， listener 会在其被调用之后自动移除。</li>
<li>passive：{Boolean}，设置为true时，表示 listener 永远不会调用 preventDefault()。如果 listener 仍然调用了这个函数，客户端将会忽略它并抛出一个控制台警告。查看 使用 passive 改善的滚屏性能 了解更多。</li>
<li>mozSystemGroup: {Boolean}，只能在 XBL 或者是 Firefox’ chrome 使用，表示 listener 被添加到 system group。</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// *useList也是react-use提供的一个钩子函数，用于在函数组件中控制数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;useEvent, useList&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, &#123;push, clear&#125;] = useList();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onKeyDown = useCallback(<span class="function">(<span class="params">&#123;key&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">'r'</span>) clear();</span><br><span class="line">    push(key);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  useEvent(<span class="string">'keydown'</span>, onKeyDown);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        Press some keys on your keyboard, &lt;code style=&#123;&#123;<span class="attr">color</span>: <span class="string">'tomato'</span>&#125;&#125;&gt;r&lt;<span class="regexp">/code&gt; key resets the list</span></span><br><span class="line"><span class="regexp">      &lt;/</span>p&gt;</span><br><span class="line">      &lt;pre&gt;</span><br><span class="line">        &#123;<span class="built_in">JSON</span>.stringify(list, <span class="literal">null</span>, <span class="number">4</span>)&#125;</span><br><span class="line">      &lt;<span class="regexp">/pre&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-17"><a href="#源码及解析-17" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useEvent.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isClient &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface ListenerType1 &#123;</span><br><span class="line">  addEventListener(name: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...args: any[]);</span><br><span class="line">  removeEventListener(name: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...args: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface ListenerType2 &#123;</span><br><span class="line">  on(name: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...args: any[]);</span><br><span class="line">  off(name: string, <span class="attr">handler</span>: <span class="function">(<span class="params">event?: any</span>) =&gt;</span> <span class="keyword">void</span>, ...args: any[]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type UseEventTarget = ListenerType1 | ListenerType2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultTarget = isClient ? <span class="built_in">window</span> : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isListenerType1 = (target: any): target is ListenerType1 =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.addEventListener;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> isListenerType2 = (target: any): target is ListenerType2 =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> !!target.on;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type AddEventListener&lt;T&gt; = T extends ListenerType1 ? T[<span class="string">'addEventListener'</span>] : T extends ListenerType2 ? T[<span class="string">'on'</span>] : never;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useEvent = <span class="xml"><span class="tag">&lt;<span class="name">T</span> <span class="attr">extends</span> <span class="attr">UseEventTarget</span>&gt;</span>(</span></span><br><span class="line">  name: Parameters&lt;AddEventListener&lt;T&gt;&gt;[0],</span><br><span class="line">  handler?: null | undefined | Parameters&lt;AddEventListener&lt;T&gt;&gt;[1],</span><br><span class="line">  target: null | T | Window = defaultTarget,</span><br><span class="line">  options?: Parameters&lt;AddEventListener&lt;T&gt;&gt;[2]</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    if (!handler) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!target) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    if (isListenerType1(target)) &#123;</span><br><span class="line">      target.addEventListener(name, handler, options);</span><br><span class="line">    &#125; else if (isListenerType2(target)) &#123;</span><br><span class="line">      target.on(name, handler, options);</span><br><span class="line">    &#125;</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      if (isListenerType1(target)) &#123;</span><br><span class="line">        target.removeEventListener(name, handler, options);</span><br><span class="line">      &#125; else if (isListenerType2(target)) &#123;</span><br><span class="line">        target.off(name, handler, options);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [name, handler, target, JSON.stringify(options)]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useEvent;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.考虑了IE的事件处理；</li>
<li>2.考虑了非浏览器端的兼容；</li>
</ul>
<h4 id="useLifecycles"><a href="#useLifecycles" class="headerlink" title="useLifecycles"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useLifecycles.md" target="_blank" rel="noopener">useLifecycles</a></h4><p>mount和unmount的生命周期封装。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLifecycles(mount, unmount);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>mount：{Function}，mount执行回调</li>
<li>unmount：{Function}，unmount执行回调</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useLifecycles&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  useLifecycles(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'MOUNTED'</span>), () =&gt; <span class="built_in">console</span>.log(<span class="string">'UNMOUNTED'</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-18"><a href="#源码及解析-18" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useLifecycles.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useLifecycles = <span class="function">(<span class="params">mount, unmount?</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mount) &#123;</span><br><span class="line">      mount();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (unmount) &#123;</span><br><span class="line">        unmount();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLifecycles;</span><br></pre></td></tr></table></figure>
<p>不需要解释。。。</p>
<h4 id="useMountedState"><a href="#useMountedState" class="headerlink" title="useMountedState"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useMountedState.md" target="_blank" rel="noopener">useMountedState</a></h4><p>组件状态回调钩子。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const isMounted = useMountedState();</span><br></pre></td></tr></table></figure></p>
<p>返回：</p>
<ul>
<li>isMounted：{Function}，<code>() =&gt; boolean</code>，获取当前是否mount状态</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useMountedState&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isMounted = useMountedState();</span><br><span class="line"></span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isMounted()) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-19"><a href="#源码及解析-19" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useMountedState.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; useCallback, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useMountedState</span>(<span class="params"></span>): (<span class="params"></span>) =&gt; <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> mountedRef = useRef&lt;boolean&gt;(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">get</span> = useCallback(() =&gt; mountedRef.current, []);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    mountedRef.current = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      mountedRef.current = <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">get</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过useEffect来控制mount状态，用ref防止作用域问题。</p>
<h4 id="useUnmountPromise"><a href="#useUnmountPromise" class="headerlink" title="useUnmountPromise"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useUnmountPromise.md" target="_blank" rel="noopener">useUnmountPromise</a></h4><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const mounted = useUnmountPromise();</span><br><span class="line"></span><br><span class="line">mounted(promise, onError);</span><br></pre></td></tr></table></figure>
<p>返回：</p>
<ul>
<li>mounted：{Function}，执行函数。参数：<ul>
<li>promise：{Function}，回调函数</li>
<li>onError：{Function}，异常捕获处理，可选</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useUnmountPromise <span class="keyword">from</span> <span class="string">'react-use/lib/useUnmountPromise'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mounted = useUnmountPromise();</span><br><span class="line">  useEffect(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> mounted(someFunction()); <span class="comment">// Will not resolve if component un-mounts.</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-20"><a href="#源码及解析-20" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useUnmountPromise.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useMemo, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Race = &lt;P extends Promise&lt;any&gt;, E = any&gt;(promise: P, onError?: (error: E) =&gt; void) =&gt; P;</span><br><span class="line"></span><br><span class="line">const useUnmountPromise = (): Race =&gt; &#123;</span><br><span class="line">  const refUnmounted = useRef(false);</span><br><span class="line">  useEffect(() =&gt; () =&gt; &#123;</span><br><span class="line">    refUnmounted.current = true;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  const wrapper = useMemo(() =&gt; &#123;</span><br><span class="line">    const race = &lt;P extends Promise&lt;any&gt;, E&gt;(promise: P, onError?: (error: E) =&gt; void) =&gt; &#123;</span><br><span class="line">      const newPromise: P = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        promise.then(</span><br><span class="line">          result =&gt; &#123;</span><br><span class="line">            if (!refUnmounted.current) resolve(result);</span><br><span class="line">          &#125;,</span><br><span class="line">          error =&gt; &#123;</span><br><span class="line">            if (!refUnmounted.current) reject(error);</span><br><span class="line">            else if (onError) onError(error);</span><br><span class="line">            else console.error('useUnmountPromise', error);</span><br><span class="line">          &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;) as P;</span><br><span class="line">      return newPromise;</span><br><span class="line">    &#125;;</span><br><span class="line">    return race;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return wrapper;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useUnmountPromise;</span><br></pre></td></tr></table></figure>
<p>promise的处理+ref的缓存。</p>
<h4 id="usePromise"><a href="#usePromise" class="headerlink" title="usePromise"></a><a href="https://github.com/streamich/react-use/blob/master/docs/usePromise.md" target="_blank" rel="noopener">usePromise</a></h4><p>用于处理函数组件中的包裹promise方法。并且此方法只有当前组件mount后才会resolve。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const mounted = usePromise();</span><br></pre></td></tr></table></figure></p>
<p>返回：</p>
<ul>
<li>mounted：{Function}，包裹函数。参数：<ul>
<li>promise：{Function}，promise方法</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;usePromise&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">&#123;promise&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> mounted = usePromise();</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> value = <span class="keyword">await</span> mounted(promise);</span><br><span class="line">      <span class="comment">// This line will not execute if &lt;Demo&gt; component gets unmounted.</span></span><br><span class="line">      setValue(value);</span><br><span class="line">    &#125;)();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-21"><a href="#源码及解析-21" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/usePromise.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useMountedState <span class="keyword">from</span> <span class="string">'./useMountedState'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type UsePromise = <span class="function"><span class="params">()</span> =&gt;</span> &lt;T&gt;(promise: Promise&lt;T&gt;) =&gt; Promise&lt;T&gt;;</span><br><span class="line"></span><br><span class="line">const usePromise: UsePromise = () =&gt; &#123;</span><br><span class="line">  const isMounted = useMountedState();</span><br><span class="line">  return useCallback(</span><br><span class="line">    (promise: Promise&lt;any&gt;) =&gt;</span><br><span class="line">      new Promise&lt;any&gt;((resolve, reject) =&gt; &#123;</span><br><span class="line">        const onValue = value =&gt; &#123;</span><br><span class="line">          isMounted() &amp;&amp; resolve(value);</span><br><span class="line">        &#125;;</span><br><span class="line">        const onError = error =&gt; &#123;</span><br><span class="line">          isMounted() &amp;&amp; reject(error);</span><br><span class="line">        &#125;;</span><br><span class="line">        promise.then(onValue, onError);</span><br><span class="line">      &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default usePromise;</span><br></pre></td></tr></table></figure>
<p>简单根据当前组件跟mount状态来进行控制。</p>
<h4 id="useLogger"><a href="#useLogger" class="headerlink" title="useLogger"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useLogger.md" target="_blank" rel="noopener">useLogger</a></h4><p>包含当前生命周期状态的log控制。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLogger(componentName: string, ...rest);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>componentName：{String}，log内容</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useLogger&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  useLogger(<span class="string">'Demo'</span>, props);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-22"><a href="#源码及解析-22" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useLogger.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useEffectOnce <span class="keyword">from</span> <span class="string">'./useEffectOnce'</span>;</span><br><span class="line"><span class="keyword">import</span> useUpdateEffect <span class="keyword">from</span> <span class="string">'./useUpdateEffect'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useLogger = <span class="function">(<span class="params">componentName: string, ...rest</span>) =&gt;</span> &#123;</span><br><span class="line">  useEffectOnce(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;componentName&#125;</span> mounted`</span>, ...rest);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;componentName&#125;</span> unmounted`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useUpdateEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;componentName&#125;</span> updated`</span>, ...rest);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useLogger;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useUpdateEffect</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useFirstMountState &#125; <span class="keyword">from</span> <span class="string">'./useFirstMountState'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useUpdateEffect: <span class="keyword">typeof</span> useEffect = <span class="function">(<span class="params">effect, deps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isFirstMount = useFirstMountState();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isFirstMount) &#123;</span><br><span class="line">      <span class="keyword">return</span> effect();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, deps);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUpdateEffect;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useFirstMountState</span></span><br><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useFirstMountState</span>(<span class="params"></span>): <span class="title">boolean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isFirst = useRef(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isFirst.current) &#123;</span><br><span class="line">    isFirst.current = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> isFirst.current;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.useUpdateEffect是通过useFirstMountState的闭包变量进行的判断，实现控制非首次触发effect的效果（update）；</li>
<li>2.useEffectOnce用于实现mount和unmount的控制回调；</li>
</ul>
<h4 id="useMount"><a href="#useMount" class="headerlink" title="useMount"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useMount.md" target="_blank" rel="noopener">useMount</a></h4><p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useMount(fn: () =&gt; void);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，回调函数；</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useMount&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  useMount(<span class="function"><span class="params">()</span> =&gt;</span> alert(<span class="string">'MOUNTED'</span>));</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-23"><a href="#源码及解析-23" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useMount.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useEffectOnce <span class="keyword">from</span> <span class="string">'./useEffectOnce'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useMount = <span class="function">(<span class="params">fn: (</span>) =&gt;</span> <span class="keyword">void</span>) =&gt; &#123;</span><br><span class="line">  useEffectOnce(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fn();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useMount;</span><br></pre></td></tr></table></figure>
<p>不需要解释。。。</p>
<h4 id="useUpdateEffect"><a href="#useUpdateEffect" class="headerlink" title="useUpdateEffect"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useUpdateEffect.md" target="_blank" rel="noopener">useUpdateEffect</a></h4><p>组件更新时的effect。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useUpdateEffect(fn, deps)</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，回调函数；</li>
<li>deps：[Array]，依赖项；</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;useUpdateEffect&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = React.useState(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">  React.useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> interval = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="function"><span class="params">count</span> =&gt;</span> count + <span class="number">1</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      clearInterval(interval)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [])</span><br><span class="line">  </span><br><span class="line">  useUpdateEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'count'</span>, count) <span class="comment">// will only show 1 and beyond</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123; <span class="comment">// *OPTIONAL*</span></span><br><span class="line">      <span class="comment">// do something on unmount</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;) <span class="comment">// you can include deps array if necessary</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Count: &#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-24"><a href="#源码及解析-24" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useUpdateEffect.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useFirstMountState &#125; <span class="keyword">from</span> <span class="string">'./useFirstMountState'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useUpdateEffect: <span class="keyword">typeof</span> useEffect = <span class="function">(<span class="params">effect, deps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isFirstMount = useFirstMountState();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isFirstMount) &#123;</span><br><span class="line">      <span class="keyword">return</span> effect();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, deps);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUpdateEffect;</span><br></pre></td></tr></table></figure>
<p>useUpdateEffect是通过useFirstMountState的闭包变量进行的判断，实现控制非首次触发effect的效果（update）</p>
<h4 id="useIsomorphicLayoutEffect"><a href="#useIsomorphicLayoutEffect" class="headerlink" title="useIsomorphicLayoutEffect"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useIsomorphicLayoutEffect.md" target="_blank" rel="noopener">useIsomorphicLayoutEffect</a></h4><p>根据环境判断使用layoutEffect/effect。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useIsomorphicLayoutEffect(effect: EffectCallback, deps?: ReadonlyArray&lt;any&gt; | undefined);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>effect：{Function}，回调</li>
<li>deps：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useIsomorphicLayoutEffect&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">&#123;value&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  useIsomorphicLayoutEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.console.log(value)</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-25"><a href="#源码及解析-25" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useIsomorphicLayoutEffect</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useLayoutEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useIsomorphicLayoutEffect = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> ? useLayoutEffect : useEffect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useIsomorphicLayoutEffect;</span><br></pre></td></tr></table></figure>
<p>根据执行环境进行了区分使用。</p>
<h4 id="useCustomCompareEffect"><a href="#useCustomCompareEffect" class="headerlink" title="useCustomCompareEffect"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useCustomCompareEffect.md" target="_blank" rel="noopener">useCustomCompareEffect</a></h4><p>通过依赖项的比较来控制effect执行。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useCustomCompareEffect(effect: () =&gt; void | (() =&gt; void | undefined), deps: any[], depsEqual: (prevDeps: any[], nextDeps: any[]) =&gt; boolean);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>effect：{Function}，副作用回调</li>
<li>deps：{Array}，依赖列表；</li>
<li>depsEqual：{Function}，比较函数；参数<ul>
<li>prevDeps：{Array}，比较前依赖项</li>
<li>nextDeps：{Array}，比较后依赖项；<br>返回：{Boolean}，是否需要执行副作用</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useCounter, useCustomCompareEffect&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"><span class="keyword">import</span> isEqual <span class="keyword">from</span> <span class="string">'lodash/isEqual'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, &#123;<span class="attr">inc</span>: inc&#125;] = useCounter(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> options = &#123; <span class="attr">step</span>: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line">  useCustomCompareEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    inc(options.step)</span><br><span class="line">  &#125;, [options], (prevDeps, nextDeps) =&gt; isEqual(prevDeps, nextDeps));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;useCustomCompareEffect <span class="keyword">with</span> deep comparison: &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-26"><a href="#源码及解析-26" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useCustomCompareEffect</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, EffectCallback, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isPrimitive = <span class="function">(<span class="params">val: any</span>) =&gt;</span> val !== <span class="built_in">Object</span>(val);</span><br><span class="line"></span><br><span class="line">type DepsEqualFnType&lt;TDeps extends DependencyList&gt; = <span class="function">(<span class="params">prevDeps: TDeps, nextDeps: TDeps</span>) =&gt;</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCustomCompareEffect = <span class="xml"><span class="tag">&lt;<span class="name">TDeps</span> <span class="attr">extends</span> <span class="attr">DependencyList</span>&gt;</span>(</span></span><br><span class="line"><span class="xml">  effect: EffectCallback,</span></span><br><span class="line"><span class="xml">  deps: TDeps,</span></span><br><span class="line">  depsEqual: DepsEqualFnType&lt;TDeps&gt;</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  if (process.env.NODE_ENV !== 'production') &#123;</span><br><span class="line">    if (!(deps instanceof Array) || !deps.length) &#123;</span><br><span class="line">      console.warn('`useCustomCompareEffect` should not be used with no dependencies. Use React.useEffect instead.');</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (deps.every(isPrimitive)) &#123;</span><br><span class="line">      console.warn(</span><br><span class="line">        '`useCustomCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.'</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (typeof depsEqual !== 'function') &#123;</span><br><span class="line">      console.warn('`useCustomCompareEffect` should be used with depsEqual callback for comparing deps list');</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const ref = useRef&lt;TDeps | undefined&gt;(undefined);</span><br><span class="line"></span><br><span class="line">  if (!ref.current || !depsEqual(deps, ref.current)) &#123;</span><br><span class="line">    ref.current = deps;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(effect, ref.current);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default useCustomCompareEffect;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.用ref来控制useEffect的缓存依赖项</li>
<li>2.如果依赖项deps都是原始数据类型的话不推荐使用此钩子</li>
</ul>
<h4 id="useDeepCompareEffect"><a href="#useDeepCompareEffect" class="headerlink" title="useDeepCompareEffect"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useDeepCompareEffect.md" target="_blank" rel="noopener">useDeepCompareEffect</a></h4><p>使用深比较effect。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useDeepCompareEffect(effect: () =&gt; void | (() =&gt; void | undefined), deps: any[]);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>effect：{Function}，副作用回调</li>
<li>deps：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useCounter, useDeepCompareEffect&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, &#123;<span class="attr">inc</span>: inc&#125;] = useCounter(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> options = &#123; <span class="attr">step</span>: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line">  useDeepCompareEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    inc(options.step)</span><br><span class="line">  &#125;, [options]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;useDeepCompareEffect: &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-27"><a href="#源码及解析-27" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useDeepCompareEffect</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, EffectCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isDeepEqual &#125; <span class="keyword">from</span> <span class="string">'./util'</span>;	<span class="comment">//import isDeepEqualReact from 'fast-deep-equal/react';</span></span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">'./useCustomCompareEffect'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isPrimitive = <span class="function">(<span class="params">val: any</span>) =&gt;</span> val !== <span class="built_in">Object</span>(val);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useDeepCompareEffect = <span class="function">(<span class="params">effect: EffectCallback, deps: DependencyList</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="built_in">Array</span>) || !deps.length) &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(<span class="string">'`useDeepCompareEffect` should not be used with no dependencies. Use React.useEffect instead.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deps.every(isPrimitive)) &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(</span><br><span class="line">        <span class="string">'`useDeepCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.'</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useCustomCompareEffect(effect, deps, isDeepEqual);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useDeepCompareEffect;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.核心的深比较函数依赖于<a href="https://www.npmjs.com/package/fast-deep-equal" target="_blank" rel="noopener">fast-deep-equal</a></li>
<li>2.如果依赖项deps都是原始数据类型的话不推荐使用此钩子</li>
</ul>
<h4 id="useShallowCompareEffect"><a href="#useShallowCompareEffect" class="headerlink" title="useShallowCompareEffect"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useShallowCompareEffect.md" target="_blank" rel="noopener">useShallowCompareEffect</a></h4><p>使用浅比较effect。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useShallowCompareEffect(effect: () =&gt; void | (() =&gt; void | undefined), deps: any[]);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>effect：{Function}，副作用回调</li>
<li>deps：{Array}，依赖列表，等同于useEffect的第二个参数，可选；</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useCounter, useShallowCompareEffect&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, &#123;<span class="attr">inc</span>: inc&#125;] = useCounter(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> options = &#123; <span class="attr">step</span>: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line">  useShallowCompareEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    inc(options.step)</span><br><span class="line">  &#125;, [options]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;useShallowCompareEffect: &#123;count&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-28"><a href="#源码及解析-28" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useShallowCompareEffect.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; DependencyList, EffectCallback &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; equal <span class="keyword">as</span> isShallowEqual &#125; <span class="keyword">from</span> <span class="string">'fast-shallow-equal'</span>;</span><br><span class="line"><span class="keyword">import</span> useCustomCompareEffect <span class="keyword">from</span> <span class="string">'./useCustomCompareEffect'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isPrimitive = <span class="function">(<span class="params">val: any</span>) =&gt;</span> val !== <span class="built_in">Object</span>(val);</span><br><span class="line"><span class="keyword">const</span> shallowEqualDepsList = <span class="function">(<span class="params">prevDeps: DependencyList, nextDeps: DependencyList</span>) =&gt;</span></span><br><span class="line">  prevDeps.every(<span class="function">(<span class="params">dep, index</span>) =&gt;</span> isShallowEqual(dep, nextDeps[index]));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useShallowCompareEffect = <span class="function">(<span class="params">effect: EffectCallback, deps: DependencyList</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(deps <span class="keyword">instanceof</span> <span class="built_in">Array</span>) || !deps.length) &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(<span class="string">'`useShallowCompareEffect` should not be used with no dependencies. Use React.useEffect instead.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deps.every(isPrimitive)) &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(</span><br><span class="line">        <span class="string">'`useShallowCompareEffect` should not be used with dependencies that are all primitive values. Use React.useEffect instead.'</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useCustomCompareEffect(effect, deps, shallowEqualDepsList);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useShallowCompareEffect;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.核心的浅比较函数依赖于<a href="https://www.npmjs.com/package/fast-shallow-equal" target="_blank" rel="noopener">fast-shallow-equal</a></li>
<li>2.如果依赖项deps都是原始数据类型的话不推荐使用此钩子</li>
</ul>
<h4 id="useRaf"><a href="#useRaf" class="headerlink" title="useRaf"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useRaf.md" target="_blank" rel="noopener">useRaf</a></h4><p>控制requestAnimationFrame。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const elapsed = useRaf(ms?: number, delay?: number): number;</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>ms：{Number}，动画总时间，毫秒。默认是1e12，即1e9秒；</li>
<li>delay：{Number}，延迟时间，毫秒。可选；</li>
</ul>
<p>返回：</p>
<ul>
<li>elapsed：{Number}，运行动画百分比</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRaf&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> elapsed = useRaf(<span class="number">5000</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      Elapsed: &#123;elapsed&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-29"><a href="#源码及解析-29" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useRaf.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> useIsomorphicLayoutEffect <span class="keyword">from</span> <span class="string">'./useIsomorphicLayoutEffect'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useRaf = (ms: number = <span class="number">1e12</span>, <span class="attr">delay</span>: number = <span class="number">0</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [elapsed, <span class="keyword">set</span>] = useState&lt;number&gt;(0);</span><br><span class="line"></span><br><span class="line">  useIsomorphicLayoutEffect(() =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> raf;</span><br><span class="line">    <span class="keyword">let</span> timerStop;</span><br><span class="line">    <span class="keyword">let</span> start;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> onFrame = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> time = <span class="built_in">Math</span>.min(<span class="number">1</span>, (<span class="built_in">Date</span>.now() - start) / ms);</span><br><span class="line">      <span class="keyword">set</span>(time);</span><br><span class="line">      loop();</span><br><span class="line">    &#125;;</span><br><span class="line">    const loop = () =&gt; &#123;</span><br><span class="line">      raf = requestAnimationFrame(onFrame);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> onStart = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      timerStop = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        cancelAnimationFrame(raf);</span><br><span class="line">        <span class="keyword">set</span>(1);</span><br><span class="line">      &#125;, ms);</span><br><span class="line">      start = Date.now();</span><br><span class="line">      loop();</span><br><span class="line">    &#125;;</span><br><span class="line">    const timerDelay = setTimeout(onStart, delay);</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      clearTimeout(timerStop);</span><br><span class="line">      clearTimeout(timerDelay);</span><br><span class="line">      cancelAnimationFrame(raf);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [ms, delay]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> elapsed;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useRaf;</span><br></pre></td></tr></table></figure>
<p>比较简单，通过requestAnimationFrame和setTimeout来控制整个运作。</p>
<h4 id="useInterval"><a href="#useInterval" class="headerlink" title="useInterval"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useInterval.md" target="_blank" rel="noopener">useInterval</a></h4><p>setInterval的控制钩子。为何要单独抽离成一个钩子，可以见<a href="https://overreacted.io/making-setinterval-declarative-with-react-hooks/" target="_blank" rel="noopener">Dan Abramov’s article on overreacted.io</a>，写得非常好了。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useInterval(callback, delay?: number)</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>callback：{Function}，回调函数；</li>
<li>delay：{Number}，定时器间隔，默认为0。</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useInterval&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [delay, setDelay] = React.useState(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> [isRunning, toggleIsRunning] = useBoolean(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  useInterval(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      setCount(count + <span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    isRunning ? delay : <span class="literal">null</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        delay: <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;delay&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;event</span> =&gt;</span> setDelay(Number(event.target.value))&#125; /&gt;</span></span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h1&gt;count: &#123;count&#125;&lt;/</span>h1&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;toggleIsRunning&#125;&gt;&#123;isRunning ? <span class="string">'stop'</span> : <span class="string">'start'</span>&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-30"><a href="#源码及解析-30" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useInterval.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useInterval = <span class="function">(<span class="params">callback: <span class="built_in">Function</span>, delay?: number | <span class="literal">null</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> savedCallback = useRef&lt;<span class="built_in">Function</span>&gt;<span class="function">(<span class="params">(</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    savedCallback.current = callback;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (delay !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> interval = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> savedCallback.current(), delay || <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> clearInterval(interval);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  &#125;, [delay]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useInterval;</span><br></pre></td></tr></table></figure>
<p>ref作为动画id避免函数组件的作用域问题。</p>
<h4 id="useHarmonicIntervalFn"><a href="#useHarmonicIntervalFn" class="headerlink" title="useHarmonicIntervalFn"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useHarmonicIntervalFn.md" target="_blank" rel="noopener">useHarmonicIntervalFn</a></h4><p>同样是setInterval的控制钩子，但是所有的effect会在同样的延迟进行。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useHarmonicIntervalFn(fn, delay?: number)</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，回调函数；</li>
<li>delay：{Number}，定时器间隔，默认为0。</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useHarmonicIntervalFn&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [delay, setDelay] = React.useState(<span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> [isRunning, toggleIsRunning] = useBoolean(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  useHarmonicIntervalFn(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      setCount(count + <span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    isRunning ? delay : <span class="literal">null</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        delay: <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;delay&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;event</span> =&gt;</span> setDelay(Number(event.target.value))&#125; /&gt;</span></span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h1&gt;count: &#123;count&#125;&lt;/</span>h1&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;toggleIsRunning&#125;&gt;&#123;isRunning ? <span class="string">'stop'</span> : <span class="string">'start'</span>&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-31"><a href="#源码及解析-31" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useHarmonicIntervalFn.ts</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; setHarmonicInterval, clearHarmonicInterval &#125; <span class="keyword">from</span> <span class="string">'set-harmonic-interval'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useHarmonicIntervalFn = <span class="function">(<span class="params">fn: <span class="built_in">Function</span>, delay: number | <span class="literal">null</span> = <span class="number">0</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> latestCallback = useRef&lt;<span class="built_in">Function</span>&gt;<span class="function">(<span class="params">(</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    latestCallback.current = fn;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (delay !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> interval = setHarmonicInterval(<span class="function"><span class="params">()</span> =&gt;</span> latestCallback.current(), delay);</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> clearHarmonicInterval(interval);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">  &#125;, [delay]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useHarmonicIntervalFn;</span><br></pre></td></tr></table></figure>
<p>核心的实现依赖于<a href="https://www.npmjs.com/package/set-harmonic-interval" target="_blank" rel="noopener">set-harmonic-interval</a>这个库。</p>
<h4 id="useSpring"><a href="#useSpring" class="headerlink" title="useSpring"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useSpring.md" target="_blank" rel="noopener">useSpring</a></h4><p>弹簧力学的动力钩子。需要安装<a href="https://www.npmjs.com/package/rebound" target="_blank" rel="noopener">rebound</a></p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const currentValue = useSpring(targetValue, tension, friction);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>targetValue：{Number}，目标值。可选，默认为0；</li>
<li>tension：{Number}，张力。可选，默认为50；</li>
<li>friction：{Number}，摩擦力。可选，默认为50。</li>
</ul>
<p>返回：</p>
<ul>
<li>currentValue：{Number}，当前值</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> useSpring <span class="keyword">from</span> <span class="string">'react-use/lib/useSpring'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [target, setTarget] = useState(<span class="number">50</span>);</span><br><span class="line">  <span class="keyword">const</span> value = useSpring(target);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;value&#125;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setTarget(<span class="number">0</span>)&#125;&gt;<span class="built_in">Set</span> <span class="number">0</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setTarget(100)&#125;&gt;Set 100&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-32"><a href="#源码及解析-32" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useSpring</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useMemo, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Spring, SpringSystem &#125; <span class="keyword">from</span> <span class="string">'rebound'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useSpring = <span class="function">(<span class="params">targetValue: number = <span class="number">0</span>, tension: number = <span class="number">50</span>, friction: number = <span class="number">3</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [spring, setSpring] = useState&lt;Spring | <span class="literal">null</span>&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;number&gt;(targetValue);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// memoize listener to being able to unsubscribe later properly, otherwise</span></span><br><span class="line">  <span class="comment">// listener fn will be different on each re-render and wouldn't unsubscribe properly.</span></span><br><span class="line">  <span class="keyword">const</span> listener = useMemo(</span><br><span class="line">    () =&gt; (&#123;</span><br><span class="line">      onSpringUpdate: <span class="function"><span class="params">currentSpring</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> newValue = currentSpring.getCurrentValue();</span><br><span class="line">        setValue(newValue);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!spring) &#123;</span><br><span class="line">      <span class="keyword">const</span> newSpring = <span class="keyword">new</span> SpringSystem().createSpring(tension, friction);</span><br><span class="line">      newSpring.setCurrentValue(targetValue);</span><br><span class="line">      setSpring(newSpring);</span><br><span class="line">      newSpring.addListener(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (spring) &#123;</span><br><span class="line">        spring.removeListener(listener);</span><br><span class="line">        setSpring(<span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [tension, friction, spring]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (spring) &#123;</span><br><span class="line">      spring.setEndValue(targetValue);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [targetValue]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useSpring;</span><br></pre></td></tr></table></figure>
<p>对rebound的封装。</p>
<h4 id="useTimeoutFn"><a href="#useTimeoutFn" class="headerlink" title="useTimeoutFn"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useTimeoutFn.md" target="_blank" rel="noopener">useTimeoutFn</a></h4><p>控制setTimeout。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const [</span><br><span class="line">    isReady: () =&gt; boolean | null,</span><br><span class="line">    cancel: () =&gt; void,</span><br><span class="line">    reset: () =&gt; void,</span><br><span class="line">] = useTimeoutFn(fn: Function, ms: number = 0);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>fn：{Function}，回调方法；</li>
<li>ms：{Number}，延迟时间，毫秒。默认是0；</li>
</ul>
<p>返回：</p>
<ul>
<li>functions：{Function[]}，控制方法集合<ul>
<li>0：<code>() =&gt; boolean | null</code>，当前是否已经完成；</li>
<li>1：<code>() =&gt; void</code>，取消方法；</li>
<li>2：<code>() =&gt; void</code>，重置方法</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useTimeoutFn &#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = React.useState(<span class="string">'Not called yet'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setState(<span class="string">`called at <span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [isReady, cancel, reset] = useTimeoutFn(fn, <span class="number">5000</span>);</span><br><span class="line">  <span class="keyword">const</span> cancelButtonClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isReady() === <span class="literal">false</span>) &#123;</span><br><span class="line">      cancel();</span><br><span class="line">      setState(<span class="string">`cancelled`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      reset();</span><br><span class="line">      setState(<span class="string">'Not called yet'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> readyState = isReady();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;&#123;readyState !== <span class="literal">null</span> ? <span class="string">'Function will be called in 5 seconds'</span> : <span class="string">'Timer cancelled'</span>&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;cancelButtonClick&#125;&gt; &#123;readyState === false ? 'cancel' : 'restart'&#125; timeout&lt;/</span>button&gt;</span><br><span class="line">      &lt;br /&gt;</span><br><span class="line">      &lt;div&gt;<span class="built_in">Function</span> state: &#123;readyState === <span class="literal">false</span> ? <span class="string">'Pending'</span> : readyState ? <span class="string">'Called'</span> : <span class="string">'Cancelled'</span>&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;&#123;state&#125;&lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-33"><a href="#源码及解析-33" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useTimeoutFn</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useCallback, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type UseTimeoutFnReturn = [<span class="function"><span class="params">()</span> =&gt;</span> boolean | <span class="literal">null</span>, () =&gt; <span class="keyword">void</span>, () =&gt; <span class="keyword">void</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimeoutFn</span>(<span class="params">fn: Function, ms: number = <span class="number">0</span></span>): <span class="title">UseTimeoutFnReturn</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ready = useRef&lt;boolean | <span class="literal">null</span>&gt;(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> timeout = useRef&lt;ReturnType&lt;<span class="keyword">typeof</span> setTimeout&gt;&gt;();</span><br><span class="line">  <span class="keyword">const</span> callback = useRef(fn);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isReady = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> ready.current, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">set</span> = useCallback(() =&gt; &#123;</span><br><span class="line">    ready.current = <span class="literal">false</span>;</span><br><span class="line">    timeout.current &amp;&amp; clearTimeout(timeout.current);</span><br><span class="line"></span><br><span class="line">    timeout.current = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      ready.current = <span class="literal">true</span>;</span><br><span class="line">      callback.current();</span><br><span class="line">    &#125;, ms);</span><br><span class="line">  &#125;, [ms]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clear = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ready.current = <span class="literal">null</span>;</span><br><span class="line">    timeout.current &amp;&amp; clearTimeout(timeout.current);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update ref when function changes</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    callback.current = fn;</span><br><span class="line">  &#125;, [fn]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set on mount, clear on unmount</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">set</span>();</span><br><span class="line"></span><br><span class="line">    return clear;</span><br><span class="line">  &#125;, [ms]);</span><br><span class="line"></span><br><span class="line">  return [isReady, clear, <span class="keyword">set</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ref作为定时器id用来避免作用域问题。并且考虑了unmount时的定时器清除。</p>
<h4 id="useTimeout"><a href="#useTimeout" class="headerlink" title="useTimeout"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useTimeout.md" target="_blank" rel="noopener">useTimeout</a></h4><p>控制setTimeout。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const [</span><br><span class="line">    isReady: () =&gt; boolean | null,</span><br><span class="line">    cancel: () =&gt; void,</span><br><span class="line">    reset: () =&gt; void,</span><br><span class="line">] = useTimeout(ms: number = 0);</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>ms：{Number}，延迟时间，毫秒；</li>
</ul>
<p>返回：</p>
<ul>
<li>functions：{Function[]}，控制方法集合<ul>
<li>0：<code>() =&gt; boolean | null</code>，当前是否已经完成；</li>
<li>1：<code>() =&gt; void</code>，取消方法；</li>
<li>2：<code>() =&gt; void</code>，重置方法</li>
</ul>
</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useTimeout &#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TestComponent</span>(<span class="params">props: &#123; ms?: number &#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ms = props.ms || <span class="number">5000</span>;</span><br><span class="line">  <span class="keyword">const</span> [isReady, cancel] = useTimeout(ms);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123; isReady() ? <span class="string">'I\'m reloaded after timeout'</span> : <span class="string">`I will be reloaded after <span class="subst">$&#123; ms <span class="regexp">/ 1000 &#125;s` &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">      &#123; isReady() === false ? &lt;button onClick=&#123; cancel &#125;&gt;Cancel&lt;/</span>button&gt; : <span class="string">''</span> &#125;</span></span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const Demo = () =&gt; &#123;</span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;TestComponent /&gt;</span></span><br><span class="line"><span class="string">      &lt;TestComponent ms=&#123; 10000 &#125; /&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-34"><a href="#源码及解析-34" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useTimeout.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> useTimeoutFn <span class="keyword">from</span> <span class="string">'./useTimeoutFn'</span>;</span><br><span class="line"><span class="keyword">import</span> useUpdate <span class="keyword">from</span> <span class="string">'./useUpdate'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type UseTimeoutReturn = [<span class="function"><span class="params">()</span> =&gt;</span> boolean | <span class="literal">null</span>, () =&gt; <span class="keyword">void</span>, () =&gt; <span class="keyword">void</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useTimeout</span>(<span class="params">ms: number = <span class="number">0</span></span>): <span class="title">UseTimeoutReturn</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> update = useUpdate();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> useTimeoutFn(update, ms);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基于useTimeoutFn，实现组件延迟更新render。</p>
<h4 id="useTween"><a href="#useTween" class="headerlink" title="useTween"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useTween.md" target="_blank" rel="noopener">useTween</a></h4><p>动画过渡钩子。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const current = useTween(easing?: string, ms?: number, delay?: number): number</span><br></pre></td></tr></table></figure></p>
<p>参数：</p>
<ul>
<li>easing：{String}，动画效果，字可见<a href="https://github.com/streamich/ts-easing/blob/master/src/index.ts" target="_blank" rel="noopener">字段集合</a>。默认为<code>&quot;inCirc&quot;</code>；</li>
<li>ms：{Number}，动画总时间，毫秒。默认是200；</li>
<li>delay：{Number}，延迟时间，毫秒。默认是0；</li>
</ul>
<p>返回：</p>
<ul>
<li>current：{Number}，当前进度。</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useTween&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> t = useTween();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      Tween: &#123;t&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-35"><a href="#源码及解析-35" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useTween.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; easing &#125; <span class="keyword">from</span> <span class="string">'ts-easing'</span>;</span><br><span class="line"><span class="keyword">import</span> useRaf <span class="keyword">from</span> <span class="string">'./useRaf'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Easing = <span class="function">(<span class="params">t: number</span>) =&gt;</span> number;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useTween = (easingName: string = <span class="string">'inCirc'</span>, <span class="attr">ms</span>: number = <span class="number">200</span>, <span class="attr">delay</span>: number = <span class="number">0</span>): <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fn: Easing = easing[easingName];</span><br><span class="line">  <span class="keyword">const</span> t = useRaf(ms, delay);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(</span><br><span class="line">        <span class="string">'useTween() expected "easingName" property to be a valid easing function name, like:'</span> +</span><br><span class="line">          <span class="string">'"'</span> +</span><br><span class="line">          <span class="built_in">Object</span>.keys(easing).join(<span class="string">'", "'</span>) +</span><br><span class="line">          <span class="string">'".'</span></span><br><span class="line">      );</span><br><span class="line">      <span class="built_in">console</span>.trace();</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> fn(t);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useTween;</span><br></pre></td></tr></table></figure>
<p>依赖于<a href="https://www.npmjs.com/package/ts-easing" target="_blank" rel="noopener">ts-easing</a>动画库，动画控制核心依赖于requestAnimationFrame。</p>
<h4 id="useUpdate"><a href="#useUpdate" class="headerlink" title="useUpdate"></a><a href="https://github.com/streamich/react-use/blob/master/docs/useUpdate.md" target="_blank" rel="noopener">useUpdate</a></h4><p>重新渲染组件。</p>
<p>语法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const update = useUpdate();</span><br></pre></td></tr></table></figure></p>
<p>返回：</p>
<ul>
<li>update：{Function}，更新函数</li>
</ul>
<p>使用：<br><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useUpdate&#125; <span class="keyword">from</span> <span class="string">'react-use'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> update = useUpdate();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;div&gt;Time: &#123;<span class="built_in">Date</span>.now()&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;update&#125;&gt;Update&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="源码及解析-36"><a href="#源码及解析-36" class="headerlink" title="源码及解析"></a>源码及解析</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/useUpdate.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateReducer = (num: number): <span class="function"><span class="params">number</span> =&gt;</span> (num + <span class="number">1</span>) % <span class="number">1</span>_000_000;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useUpdate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [, update] = useReducer(updateReducer, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> update <span class="keyword">as</span> () =&gt; <span class="keyword">void</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUpdate;</span><br></pre></td></tr></table></figure>
<ul>
<li>依赖于useReducer，以计数的形式来触发组件的更新；</li>
<li><code>1_000_000</code>其实就是<code>1000000</code>；</li>
</ul>
</div></article></div><div class="post-paginator"><div class="post-links"><div class="post-prev"><a href="/2020/08/09/SE/vite和snowpack/" class="prev">Previous Post<span>【笔记】vite和snowpack</span></a></div><div class="post-next"><a href="/2020/08/08/tools/【工具】性能测试中QPS、TPS等字段含义/" class="next">Next Post<span>【工具】性能测试中QPS、TPS等字段含义</span></a></div></div></div></div><div class="sidebar"><div class="social-links"><ul><li class="social-link"><a href="http://github.com/MichealWayne" target="_blank" class="link-github"><i class="icon icon-github"></i></a></li><li class="social-link"><a href="mailto:michealwayne@163.com" target="_self" class="link-mail"><i class="icon icon-mail"></i></a></li></ul></div><div class="recent-posts widget"><h3 class="widget-title"> Recent Posts</h3><div class="widget-content"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/03/15/ai/【笔记】19届阿里D2终端技术大会纪要/">【笔记】19届阿里D2终端技术大会纪要</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/01/19/ai/【调研】AI 编程工具WindSurf使用技巧——WindsurfRules配置/">【调研】AI 编程工具WindSurf使用技巧——WindsurfRules配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/01/05/ai/【笔记】MCP 协议：连接 AI 模型与外部世界的桥梁/">【AI】【笔记】MCP 协议：连接 AI 模型与外部世界的桥梁</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/01/05/ai/【调研】AI前端编程工具——CopyCoder/">AI 前端编程工具的一个得力助手——CopyCoder</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/12/08/react/【工具】React组件性能分析工具——ReactScan/">【笔记】React 组件性能分析工具——ReactScan</a></li></ul></div></div><div class="recent-comment widget"><h3 class="widget-title"> Author</h3><div class="widget-content"><div class="m-author"><div class="u-avatar"><img src="data:image/jpeg;base64,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"></div><div class="u-author_tit"><p>My name is Micheal Wayne and this is my blog.<br>I am a front-end software engineer.<br>Contact: <a href="mailto:michealwayne@163.com"> <span>michealwayne@163.com</span></a></p></div></div></div></div><div class="tag-lists widget"><h3 class="widget-title"> Tags</h3><div class="widget-content"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/APM/">APM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BOM/">BOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bun/">Bun</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DOM/">DOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IDE/">IDE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OKR/">OKR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UML/">UML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UX/">UX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebApi/">WebApi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zepto/">Zepto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ai/">ai</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es/">es</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eslint/">eslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gpt/">gpt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lerna/">lerna</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lottie/">lottie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prettier/">prettier</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prompt/">prompt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pwa/">pwa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sketch/">sketch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skywalking/">skywalking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/taro/">taro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tslint/">tslint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webApi/">webApi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码规范/">代码规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动效/">动效</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图形/">图形</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安全/">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小程序/">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工程/">工程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/微前端/">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/思维逻辑/">思维逻辑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能/">性能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/插件/">插件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日常工作/">日常工作</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/架构/">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/概念/">概念</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则/">正则</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浏览器/">浏览器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/用户体验/">用户体验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编码/">编码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络协议/">网络协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/规范/">规范</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/调试/">调试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/质量/">质量</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨端/">跨端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件/">软件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/软件工程/">软件工程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/项目管理/">项目管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高并发/">高并发</a></li></ul></div></div><div class="archive-lists widget"><h3 class="widget-title"> Archive</h3><div class="widget-content"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/03/">March 2025</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">January 2025</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">June 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">5</span></li></ul></div></div></div></div></div><footer><div class="copyright"><div class="container"><div class="col-6"><div class="site-info">© 2016 - 2025 <a href="http://blog.michealwayne.cn">Micheal Wayne</a></div></div><div class="col-6"><div class="site-contact"><div class="social-links"><ul><li class="social-link"><a href="http://github.com/MichealWayne" target="_blank" class="link-github"><i class="icon icon-github"></i></a></li><li class="social-link"><a href="mailto:michealwayne@163.com" target="_self" class="link-mail"><i class="icon icon-mail"></i></a></li></ul></div></div></div></div></div></footer><a class="scroll-up"><span class="icon icon-up"></span></a><script src="https://code.jquery.com/jquery-3.1.0.min.js"></script><script src="/js/posfixed.js"></script><script src="/js/utils.js"></script><script src="/js/search.js"></script></body></html>